<span style="display: none;" [id]="id"></span>
<div style="padding: 0 2rem 0 1rem" *ngIf="onlySmartField">

    <!-- smart-input -->

    <app-code-style-smart-input-field apiLink="{{apiLink}}" [mappingList]="mappingList | async" [simplefield]="true"
        (updateData)="onSmartInputCodeData($event)" (keyEnter)="doSearchResult()" #onlySmartFieldElement>
    </app-code-style-smart-input-field>
</div>
<div *ngIf="!onlySmartField">
    <div class="inputs-container">

        <div class="example-container-smart">
            <div>
                <!-- static fields -->
                <!-- if proto selector-->
                <app-code-proto-selector 
                    [value]="fields[0]?.value"
                    [mappingList]="mappingList | async" (protoChanged)="onProtoChange($event)" [id]="fields[0]?.name">
                </app-code-proto-selector>
            </div>
            <div *ngFor="let item of fields" [ngClass]="{smartContainer : item.form_type === 'smart-input'}">

                <!-- if item is targetResultsContainer -->

                <mat-form-field class="limit-selector" style="flex-grow:1"
                    *ngIf="item.field_name !== 'loki' && item.field_name === 'targetResultsContainer'">
                    <mat-label>{{item.selection}}</mat-label>
                    <mat-select multiple [formControl]="targetResultsContainerValue"
                        [compareWith]="compareResultListItem" (selectionChange)="onChangeTargetResultsContainer()"
                        name="targetResultsContainer" ngDefaultControl>
                        <mat-option *ngFor="let listItem of widgetResultList" [value]="listItem">
                            {{listItem.type === 'widget' ? 'widget: ' : ''}} {{listItem.title}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>


                <!-- if proto selector
                <app-code-proto-selector *ngIf="item.field_name === 'proto_selector'"
                    [mappingList]="mappingList | async" (protoChanged)="onProtoChange($event)" [id]="item.name">

                </app-code-proto-selector> -->


                <!-- if LOKI Field -->

                <app-code-style-field *ngIf="item.field_name === 'loki' && item.field_name !== 'targetResultsContainer'"
                    style="display: block" [queryText]="lokiQueryText" (updateData)="onLokiCodeData($event)">
                </app-code-style-field>

                <!-- smart-input -->
                <div>
                    <app-code-style-smart-input-field style="width: 100%;" [id]="item.name"
                        *ngIf="item.form_type === 'smart-input'" [apiLink]="item.full_api_link" [queryText]="item.value"
                        (updateData)="onSmartInputCodeData($event, item)"></app-code-style-smart-input-field>

                </div>


                <!-- if other Fields -->

                <mat-form-field style="display: block" class="limit-selector query" *ngIf="
                    item.field_name !== 'loki' &&
                    item.field_name !== 'targetResultsContainer' &&
                    item.field_name !== 'proto_selector' &&
                    item.form_type !== 'smart-input'
                   
                ">

                    <mat-label>{{item.selection}}</mat-label>

                    <!-- Text Field (by Default) -->

                    <input matInput *ngIf="!item.form_default" [(ngModel)]="item.value"
                        [ngModelOptions]="{standalone: true}" (change)="onChangeField($event)">

                    <!-- Autocomplete Text Field -->

                    <input matInput
                        *ngIf="item.form_default && item.form_type === 'input' && item.selection === 'Query Limit'"
                        [formControl]="item.formControl" [matAutocomplete]="form_default">

                    <mat-autocomplete #form_default="matAutocomplete">
                        <mat-option *ngFor="let option of item.filteredOptions | async"
                            [value]="option.name ? option.name : option">
                            {{option.name ? option.name : option}}
                        </mat-option>
                    </mat-autocomplete>

                    <!-- SELECT FIELD -->

                    <mat-select *ngIf="item.form_type === 'select' && item.form_default" [(ngModel)]="item.value"
                        (selectionChange)="onChangeField($event)" name="select_field" ngDefaultControl>
                        <mat-option *ngFor="let option of item.form_default"
                            [value]="option.name ? option.name : option">
                            {{option.name ? option.name : option}}
                        </mat-option>
                    </mat-select>

                    <!-- MULTISELECT FIELD -->

                    <mat-select multiple *ngIf="item.form_type === 'multiselect' && item.form_default"
                        [(ngModel)]="item.value" (selectionChange)="onChangeField($event, item)"
                        name="multiple_select_field" ngDefaultControl>
                        <mat-option *ngFor="let option of item.form_default"
                            [value]="option.name ? option.name : option">
                            {{option.name ? option.name : option}}
                        </mat-option>
                    </mat-select>

                </mat-form-field>


            </div>
        </div>
    </div>

</div>

<div class="action-buttons" [className]="buttonState ? 'show' : 'hide'">
    <button mat-raised-button class="clear-btn" (click)="onClearFields()">{{'LINK.buttons.clear' | translate}}</button>
    <button mat-raised-button class="search-btn" (click)="doSearchResult()">{{'LINK.buttons.search' | translate}}</button>
</div>
<div class="info-label">{{ 'widgets.smartInput.widget.ctrlEnter' | translate }}</div>