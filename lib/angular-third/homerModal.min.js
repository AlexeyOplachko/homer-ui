/*
 AGPLv2
 @author Alexandr Dubovikov <alexandr.dubovikov@gmail.com>

 Based on ocModal
 @author Olivier Combe <olivier.combe@gmail.com>
*/
(function(){var i=angular.module("homer.modal",[]);i.factory("$homerModal",["$rootScope","$controller","$location","$timeout","$compile","$sniffer","$q",function(f,p,k,m,g,b,h){var q=angular.element(document.body),i=angular.element('<div role="dialog" tabindex="-1" class="modal2"></div>'),r=angular.element('<div class="modal-wrapper"></div>'),n={},e=[],s;r.css("display","none");r.append(i);q.append(r);i.on("click",function(a){angular.element(a.target).hasClass("modal-backdrop")&&f.$apply(function(){j.closeOnEsc()});
a.stopPropagation()});var l=function(a){var d=0,a=angular.isString(a)?a.split(/\s*,\s*/):[];angular.forEach(a,function(a){d=Math.max(parseFloat(a)||0,d)});return d};angular.element(document).on("keyup",function(a){27==a.keyCode&&0<e.length&&(a.stopPropagation(),f.$apply(function(){j.closeOnEsc(e[e.length-1])}))});var j={waitingForOpen:!1,getOpenedModals:function(){return e},register:function(a){n[a.id||"_default"]=a},remove:function(a){delete n[a||"_default"]},open:function(a){"string"===typeof a&&
(a=a.match("<")?{template:a}:{url:a});var d=n[a.id||"_default"];if(d)if(d&&-1!==e.indexOf(a.id||"_default"))j.waitingForOpen||(j.waitingForOpen=!0,j.close(a.id).then(function(){j.open(a)}));else{if(!j.waitingForOpen)if(0===e.length)s=document.body.style.overflow,document.body.style.overflow="hidden",r.css("display","block");else for(var b=0,h=e.length;b<h;b++){var l=n[e[b]].$element;n[e[b]].baseZIndex=l.css("z-index");l.css("z-index","-1");l.addClass("no-backdrop")}j.waitingForOpen=!1;e.push(a.id||
"_default");d.params=a;d.$scope.customClass=d.params.cls;d.$scope.customId=a.id?a.id:"_default";d.$scope.divLeft=a.divLeft?a.divLeft:"100px";d.$scope.divTop=a.divTop?a.divTop:"100px";f.$digest();q[0].offsetWidth;m(function(){d.$scope.modalShow=!0},100);if("function"===typeof d.params.onOpen)d.params.onOpen();var k=d.$scope.$on("$includeContentLoaded",function(a){d.params.init&&!d.params.isolate&&angular.extend(a.targetScope,d.params.init);"string"===typeof d.params.controller&&p(d.params.controller,
{$scope:a.targetScope,$init:d.params.init,$homerModalParams:d.params});k()});if(d.params.template)d.$scope.modalTemplate=d.params.template;else if(d.params.url)d.$scope.modalUrl=d.params.url;else throw"You need to define a template or an url";"function"===typeof callback&&d.$scope.callbacksList.push(callback);if("function"===typeof d.params.onOpen)d.params.onOpen()}else i.append(g('<div homer-modal="'+(a.id?a.id:"_default")+'"></div>')(f)),m(function(){j.open(a)})},closeOnEsc:function(a){if(!1!==
n[a||e[e.length-1]].params.closeOnEsc)return j.close(a)},close:function(a){var d,g=h.defer();d="string"===typeof a&&-1!==e.indexOf(a)?Array.prototype.slice.call(arguments,1):arguments;if("undefined"===typeof a||-1===e.indexOf(a))a=e[e.length-1];var f=n[a||e[e.length-1]];if(f&&!0===f.$scope.modalShow){var k,i=angular.element(f.$element[0].querySelector(".modal-content")),q=0;if(b.transitions||b.animations){var p=b.vendorPrefix+"Animation",u=b.vendorPrefix+"Transition";angular.forEach(i,function(a){if(1==
a.nodeType){var a=window.getComputedStyle(a)||{},d=Math.max(l(a.transitionDelay),l(a[u+"Delay"])),f=Math.max(l(a.animationDelay),l(a[p+"Delay"])),e=Math.max(l(a.transitionDuration),l(a[u+"Duration"])),b=Math.max(l(a.animationDuration),l(a[p+"Duration"]));0<b&&(b*=Math.max(parseInt(a.animationIterationCount)||0,parseInt(a[p+"IterationCount"])||0,1));q=Math.max(f+b,d+e,q)}})}k=1E3*q;m(function(){f.$scope.modalShow=!1;m(function(){f.$scope.$destroy();f.$element.remove();f.callbacksList=[];e.splice(e.indexOf(a||
e[e.length-1]),1);if(0===e.length)j.waitingForOpen||(document.body.style.overflow=s,r.css("display","none"));else{var b=n[e[e.length-1]];b.$element.css("z-index",b.baseZIndex);b.$element.removeClass("no-backdrop")}"function"===typeof f.params.onClose&&f.params.onClose.apply(void 0,d);g.resolve()},k)})}else g.resolve();return g.promise}};return j}]);i.directive("homerModal",["$homerModal","$compile","$timeout",function(f,i){return{restrict:"AE",replace:!0,scope:!0,template:'<div><div draggable class="modal-content {{customClass}}" ng-class="{opened: modalShow}" ng-if="modalTemplate"></div><div draggable id="{{customId}}" class="modal-content {{customClass}}" ng-class="{opened: modalShow}" ng-include="modalUrl" style="top: {{divTop}}; left: {{divLeft}}"></div></div>',
link:function(k,m,g){var b=g.homerModal,h;k.closeModal=function(){var g=Array.prototype.slice.call(arguments);g.unshift(b);f.close.apply(void 0,g)};f.register({id:b,$scope:k,$element:m});m.on("$destroy",function(){f.remove(b)});k.$watch("modalTemplate",function(b){"undefined"!==typeof b&&(h||(h=angular.element(m.children()[1])),h.append(i(b)(k)),k.$emit("$includeContentLoaded"))})}}}]);i.directive("homerModalOpen",["$homerModal",function(f){return{restrict:"A",require:"?modal",link:function(i,k,m){k.on("click touchstart",
function(g){g.preventDefault();g.stopPropagation();var b=i.$new().$eval(m.homerModalOpen);if(b){"number"===typeof b?b={url:m.homerModalOpen}:"string"===typeof b&&(b={url:b});if(!b.url)throw"You need to set the modal url";i.$apply(function(){f.open(b)})}})}}}])})();
(function(i,f,p){function k(a,c){for(var d in a){var b=a[d];if(!~(""+b).indexOf("-")&&q[b]!==p)return"pfx"==c?b:!0}return!1}function m(a,c,b){var d=a.charAt(0).toUpperCase()+a.slice(1),f=(a+" "+B.join(d+" ")+d).split(" ");if("string"===typeof c||"undefined"===typeof c)return k(f,c);f=(a+" "+r.join(d+" ")+d).split(" ");a:{var a=f,e;for(e in a)if(d=c[a[e]],d!==p){if(!1===b){c=a[e];break a}if("function"===typeof d){c=d.bind(b||c);break a}c=d;break a}c=!1}return c}var g={},b=f.documentElement,h=f.createElement("modernizr"),
q=h.style,B=["Webkit","Moz","O","ms"],r=["webkit","moz","o","ms"],h={},i=[],n=i.slice,e,s={}.hasOwnProperty,l;l="undefined"!==typeof s&&"undefined"!==typeof s.call?function(a,c){return s.call(a,c)}:function(a,c){return c in a&&"undefined"===typeof a.constructor.prototype[c]};Function.prototype.bind||(Function.prototype.bind=function(a){var c=this;if("function"!=typeof c)throw new TypeError;var d=n.call(arguments,1),b=function(){if(this instanceof b){var f=function(){};f.prototype=c.prototype;var f=
new f,e=c.apply(f,d.concat(n.call(arguments)));return Object(e)===e?e:f}return c.apply(a,d.concat(n.call(arguments)))};return b});h.flexbox=function(){return m("flexWrap")};h.csstransforms=function(){return!!m("transform")};for(var j in h)l(h,j)&&(e=j.toLowerCase(),g[e]=h[j](),i.push((g[e]?"":"no-")+e));g.addTest=function(a,c){if("object"==typeof a)for(var d in a)l(a,d)&&g.addTest(d,a[d]);else{a=a.toLowerCase();if(g[a]!==p)return g;c="function"==typeof c?c():c;b.className+=" "+(c?"":"no-")+a;g[a]=
c}return g};q.cssText="";var h=null,a=function(){var a=v.elements;return"string"==typeof a?a.split(" "):a},d=function(a){var c=u[a[D]];c||(c={},x++,a[D]=x,u[x]=c);return c},C=function(a,c,b){c||(c=f);if(t)return c.createElement(a);b||(b=d(c));c=b.cache[a]?b.cache[a].cloneNode():F.test(a)?(b.cache[a]=b.createElem(a)).cloneNode():b.createElem(a);return c.canHaveChildren&&!E.test(a)&&!c.tagUrn?b.frag.appendChild(c):c};j=function(b){b||(b=f);var c=d(b);if(v.shivCSS&&!w&&!c.hasCSS){var e,g=b;e=g.createElement("p");
g=g.getElementsByTagName("head")[0]||g.documentElement;e.innerHTML="x<style>article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}</style>";e=g.insertBefore(e.lastChild,g.firstChild);c.hasCSS=!!e}if(!t){var h=b;c.cache||(c.cache={},c.createElem=h.createElement,c.createFrag=h.createDocumentFragment,c.frag=c.createFrag());h.createElement=function(a){return!v.shivMethods?c.createElem(a):C(a,h,c)};h.createDocumentFragment=
Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+a().join().replace(/[\w\-]+/g,function(a){c.createElem(a);c.frag.createElement(a);return'c("'+a+'")'})+");return n}")(v,c.frag)}return b};var h=this.html5||{},E=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,F=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,w,D="_html5shiv",x=0,u={},t;try{var y=f.createElement("a");y.innerHTML=
"<xyz></xyz>";w="hidden"in y;var z;if(!(z=1==y.childNodes.length)){f.createElement("a");var A=f.createDocumentFragment();z="undefined"==typeof A.cloneNode||"undefined"==typeof A.createDocumentFragment||"undefined"==typeof A.createElement}t=z}catch(G){t=w=!0}var v={elements:h.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:"3.7.0",shivCSS:!1!==h.shivCSS,
supportsUnknownElements:t,shivMethods:!1!==h.shivMethods,type:"default",shivDocument:j,createElement:C,createDocumentFragment:function(b,c){b||(b=f);if(t)return b.createDocumentFragment();for(var c=c||d(b),e=c.frag.cloneNode(),g=0,h=a(),i=h.length;g<i;g++)e.createElement(h[g]);return e}};this.html5=v;j(f);g._version="2.8.2";g._domPrefixes=r;g._cssomPrefixes=B;g.testProp=function(a){return k([a])};g.testAllProps=m;b.className=b.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(" js "+i.join(" "));return g})(this,
this.document);
