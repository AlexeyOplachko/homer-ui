(function(a){(a.homer=a.homer||{}).modules={app:{name:"homerApp"}}})(window);function isUndefined(a){return"undefined"==typeof a}function defineHomerAngularModule(a,b){return angular.module(a,b)}function defineHomerJsLibrary(a,b,d){if(isUndefined(d)&&(d=b,b=[],d instanceof Array))for(var c=0;c<d.length-1;++c)b.push(d[c]);return angular.module(a,b).factory(a,d)}$.tmpl=function(a,b){do{var d=a;a=a.replace(/#{([^}]+)}/g,function(a,d){var g=b[$.trim(d)];return void 0===g?a:g});d=a!==d}while(d);return a};
function defineExportTemplate(){return"HOMER5-#{destination_ip}-#{ruri_user}-#{date}"};(function(a,b){b.modules.core={name:"homer-core",services:{eventbus:"eventbus",search:"search",profile:"userProfile",store:"storeService"}};a.module(b.modules.core.name,["ui.router"])})(angular,homer);(function(a,b){a.module(b.modules.core.name).factory(b.modules.core.services.profile,["$q","$http","eventbus","$log",function(b,c,e,g){var h=!1,f={},k={timerange:{from:new Date((new Date).getTime()-9E5),to:new Date},search:{},transaction:{},result:{},node:{},limit:200};f.result=k.result;f.node=k.node;f.transaction=k.transaction;f.limit=k.limit;f.timerange=k.timerange;f.search=k.search;var l=function(a){return a.lastName+a.firstName},n=function(a){delete f[a]},m=function(a,f){var e="api/v1/profile/store";
null!=a&&(e="api/v1/profile/store/"+a);var g={id:a,param:f},k=b.defer();c.post(e,g,{handleStatus:[403,503]}).then(function(a){k.resolve(a.data)},function(a){k.reject()});return k.promise},q=function(a,f){var e=b.defer();c["delete"]("api/v1/profile/store/"+a,{handleStatus:[403,503]}).then(function(a){e.resolve(a.data)},function(a){e.reject()});return e.promise},r=function(){var a=b.defer();c["delete"]("api/v1/profile/store/",{handleStatus:[403,503]}).then(function(b){a.resolve(b.data)},function(b){a.reject()});
return a.promise};return{setProfile:function(a,b){f[a]=b;m(a,b)},getProfile:function(a){return f[a]},deleteProfile:function(a){n(a);q(a)},setLocalProfile:function(a,b){f[a]=b},getLocalProfile:function(a){return f[a]},deleteLocalProfile:n,deleteAllProfile:function(){r()},getRemoteProfile:function(a){var e=b.defer();c.get("api/v1/profile/store/"+a,{handleStatus:[403,503]}).success(function(a){var b=JSON.parse(value);"timerange"==l&&(b.from=new Date(b.from),b.to=new Date(b.to),k.timerange=b);f[l]=b;
k[l]=b;e.resolve(a.data)}).error(function(){e.reject()});return e.promise},setRemoteProfile:m,deleteRemoteProfile:q,getAll:function(){var e=b.defer();if(1==h)return e.resolve(h),e.promise;c.get("api/v1/profile/store",{handleStatus:[403,503]}).success(function(b){a.forEach(b.data,function(b,d){var c=a.fromJson(b);"timerange"==d&&(c.from=new Date(c.from),c.to=new Date(c.to),k.timerange=c);f[d]=c;k[d]=c;h=!0;e.resolve(d)})}).error(function(a){e.reject("Error: request returned status "+a)});return e.promise},
profileScope:k}}])})(angular,homer);(function(a,b){a.module(b.modules.core.name).factory(b.modules.core.services.eventbus,["$rootScope",function(a){return{subscribe:function(b,e){return a.$on(b,e)},broadcast:function(b,e){a.$emit(b,e)}}}])})(angular,homer);(function(a,b){a.module(b.modules.core.name).factory(b.modules.core.services.search,["$q","$http","eventbus",function(a,b,e){var g={},h={fromdate:new Date((new Date).getTime()-3E5),todate:new Date},f={timestamp:{from:new Date((new Date).getTime()-3E5),to:new Date},param:{transaction:{call:!0,registration:!0,rest:!0},limit:200}};return{searchByMethod:function(e){var f=a.defer();b.post("api/v1/search/data",e,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?f.reject("user not authorized"):
f.resolve(a.data.data)},function(a){f.reject("bad response combination")});return f.promise},searchMethod:function(e){var f=a.defer();b.post("api/v1/search/method",e,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?f.reject("user not authorized"):f.resolve(a.data.data)},function(a){f.reject("bad response combination")});return f.promise},searchMessage:function(e){var f=a.defer();b.post("api/v1/search/message",e,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?f.reject("user not authorized"):
f.resolve(a.data.data)},function(a){f.reject("bad response combination")});return f.promise},searchTransaction:function(e){var f=a.defer();b.post("api/v1/search/transaction",e,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?f.reject("user not authorized"):f.resolve(a.data.data)},function(a){f.reject("bad response combination")});return f.promise},makePcapTextforTransaction:function(f,e){var g=a.defer(),h="api/v1/search/export/";b.post(1==e?h+"text":h+"pcap",f,{responseType:"arraybuffer",
handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?g.reject("user not authorized"):g.resolve(a.data)},function(a){g.reject("bad response combination")});return g.promise},makePcapTextData:function(f,e){var g=a.defer(),h="api/v1/search/export/data/";b.post(1==e?h+"text":h+"pcap",f,{responseType:"arraybuffer",handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?g.reject("user not authorized"):g.resolve(a.data)},function(a){g.reject("bad response combination")});return g.promise},
createShareLink:function(f){var e=a.defer();b.post("api/v1/search/sharelink",f,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?e.reject("user not authorized"):e.resolve(a.data.data)},function(a){e.reject("bad response combination")});return e.promise},getTimeRange:function(){return h},setTimeRange:function(a){h=a},getSearchData:function(){return f},setSearchData:function(a){f=a},getSearchValue:function(){return g},setSearchValue:function(a){g=a},searchValue:g,searchRTCPReport:function(e){var f=
a.defer();b.post("api/v1/report/rtcp",e,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?f.reject("user not authorized"):f.resolve(a.data.data)},function(a){f.reject("bad response combination")});return f.promise},searchLogReport:function(f){var e=a.defer();b.post("api/v1/report/log",f,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?e.reject("user not authorized"):e.resolve(a.data.data)},function(a){e.reject("bad response combination")});return e.promise},searchQualityReport:function(e,
f){var g=a.defer();b.post("api/v1/report/quality/"+e,f,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?g.reject("user not authorized"):g.resolve(a.data.data)},function(a){g.reject("bad response combination")});return g.promise},loadNode:function(){var e=a.defer();b.get("api/v1/dashboard/node",{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?e.reject("user not authorized"):e.resolve(a.data.data)},function(a){e.reject("bad response combination")});return e.promise}}}]).factory("sessionRecoverer",
["$q","eventbus","$rootScope","$location",function(a,c,e,g){return{responseError:function(h){403==h.status&&(e.loggedIn=!1,c.broadcast(b.modules.auth.events.userLoggedOut),g.path(b.modules.auth.routes.login));return a.reject(h)}}}]).config(["$httpProvider",function(a){a.interceptors.push("sessionRecoverer")}])})(angular,homer);(function(a,b){a.module(b.modules.core.name).factory(b.modules.core.services.store,["$q","$http","eventbus",function(a,b,e){return{getAll:function(){var e=a.defer();b.get("api/v1/dashboard/store",{handleStatus:[403,503]}).then(function(a){e.resolve(a.data)},function(a){e.reject()});return e.promise},get:function(e){var h=a.defer();b.get("api/v1/dashboard/store/"+e,{handleStatus:[403,503]}).success(function(a){h.resolve(a.data)}).error(function(){h.reject()});return h.promise},set:function(e,h){var f=
a.defer();b.post("api/v1/dashboard/store/"+e,h,{handleStatus:[403,503]}).then(function(a){f.resolve(a.data)},function(a){f.reject()});return f.promise},"delete":function(e,h){var f=a.defer();b["delete"]("api/v1/dashboard/store/"+e,{handleStatus:[403,503]}).then(function(a){f.resolve(a.data)},function(a){f.reject()});return f.promise},menu:function(e,h){var f=a.defer();b.post("api/v1/dashboard/menu/"+e,h,{handleStatus:[403,503]}).then(function(a){f.resolve(a.data)},function(a){f.reject()});return f.promise}}}])})(angular,
homer);(function(a,b){a.module(b.modules.core.name).directive("compareTo",function(){return{scope:{targetModel:"=compareTo"},require:"ngModel",link:function(a,b,e,g){a.$watch(function(){var e=b.val(),f=a.targetModel;return null!==f?e===f:!1},function(a){g.$setValidity("errorCompareTo",a)})}}}).directive("scroll",function(b){return function(c,e,g){a.element(b).bind("scroll",function(){c.boolChangeClass=50<=this.pageYOffset?!0:!1;c.$apply()})}}).directive("autoHeight",["$window","$timeout",function(b,c){return function(c,
g){var h=a.element(b);c.getWindowDimensions=function(){return{h:h.height(),w:h.width()}};c.$watch(c.getWindowDimensions,function(a,b){c.windowHeight=a.h;c.windowWidth=a.w;c.style=function(){return{height:a.h-100+"px",width:a.w-100+"px"}}},!0);h.bind("resize",function(){c.$apply()})}}])})(angular,homer);(function(a,b){b.modules.structures={name:"structures"};a.module(b.modules.structures.name,["adf"]).config(function(a){a.structure("12",{rows:[{columns:[{styleClass:"col-md-12"}]}]}).structure("6-6",{rows:[{columns:[{styleClass:"col-md-6"},{styleClass:"col-md-6"}]}]}).structure("4-4-4",{rows:[{columns:[{styleClass:"col-md-4"},{styleClass:"col-md-4"},{styleClass:"col-md-4"}]}]}).structure("4-8",{rows:[{columns:[{styleClass:"col-md-4",widgets:[]},{styleClass:"col-md-8",widgets:[]}]}]}).structure("12/4-4-4",
{rows:[{columns:[{styleClass:"col-md-12"}]},{columns:[{styleClass:"col-md-4"},{styleClass:"col-md-4"},{styleClass:"col-md-4"}]}]}).structure("12/6-6",{rows:[{columns:[{styleClass:"col-md-12"}]},{columns:[{styleClass:"col-md-6"},{styleClass:"col-md-6"}]}]}).structure("12/6-6/12",{rows:[{columns:[{styleClass:"col-md-12"}]},{columns:[{styleClass:"col-md-6"},{styleClass:"col-md-6"}]},{columns:[{styleClass:"col-md-12"}]}]})})})(angular,homer);(function(a,b){b.modules.auth={name:"auth",enums:{authorised:{authorised:0,loginRequired:1,notAuthorised:2},permissionCheckType:{atLeastOne:0,combinationRequired:1}},events:{userLoggedIn:"auth:user:loggedIn",usernotAuthorised:"auth:user:notauthorised",userLoggedOut:"auth:user:loggedOut"},controllers:{login:"loginCtrl",logout:"logoutCtrl"},services:{authentication:"authentication",authorization:"authorization"},routes:{login:"/login",logout:"/logout",notAuthorised:"/not-authorised"},state:{login:"login",
logout:"logout",notAuthorised:"notauthorised"}};a.module(b.modules.auth.name,["ui.router",b.modules.core.name])})(angular,homer);(function(a,b){a.module(b.modules.auth.name).config(["$stateProvider","$urlRouterProvider",function(a,c){a.state(b.modules.auth.state.login,{url:b.modules.auth.routes.login,controller:b.modules.auth.controllers.login,templateUrl:"js/modules/auth/html/login.tmpl.html"});a.state(b.modules.auth.state.logout,{url:b.modules.auth.routes.logout,controller:b.modules.auth.controllers.logout,templateUrl:"js/modules/auth/html/logout.tmpl.html"});a.state(b.modules.auth.state.notAuthorised,{url:b.modules.auth.routes.notAuthorised,
controller:b.modules.auth.controllers.login,templateUrl:"js/modules/auth/html/not-authorised.tmpl.html"});c.otherwise(b.modules.pages.routes.home)}])})(angular,homer);(function(a,b){a.module(b.modules.auth.name).factory(b.modules.auth.services.authentication,["$q","$http","eventbus",function(a,c,e){var g,h=function(a,b,d){return{isAuthenticated:b,name:a,permissions:d}};return{login:function(f,k){var l=a.defer();c.post("api/v1/session",{username:f,password:k}).then(function(a){console.log(a.data);if("false"==a.data.auth)l.reject("Unknown Username / Password combination");else{var d=a.data.data.grp.split(",");console.log(d);g=h(f,!0,d);console.log(a.data.data.grp);
e.broadcast(b.modules.auth.events.userLoggedIn,g);l.resolve(g)}},function(a){console.log(a);l.reject("Unknown Username / Password combination")});return l.promise},logout:function(){var f=a.defer();g=void 0;e.broadcast(b.modules.auth.events.userLoggedOut);c["delete"]("api/v1/session").then(function(a){f.resolve(!1)},function(a){f.reject(!1)});return f.promise},session:function(){var f=a.defer();c.get("api/v1/session").then(function(a){if("false"==a.data.auth)g=h("",!1,""),e.broadcast(b.modules.auth.events.usernotAuthorised,
g),f.reject("Unknown Username / Password combination");else{var d=a.data.data.grp.split(",");g=h(a.data.data.username,!0,d);e.broadcast(b.modules.auth.events.userLoggedIn,g);f.resolve(g)}},function(a){f.reject("Unknown Username / Password combination")});return f.promise},user:function(){var f=a.defer();c.get("api/v1/user").then(function(a){if("false"==a.data.auth)console.log("SESSION:"+a.data.auth),f.reject("unknown username");else{var d=a.data.data.user.grp.split(",");g=h(a.data.data.user.username,
!0,d);e.broadcast(b.modules.auth.events.userLoggedIn,g);f.resolve(g)}},function(a){f.reject("Unknown Username")});return f.promise},getCurrentLoginUser:function(){return g}}}])})(angular,homer);(function(a,b){a.module(b.modules.auth.name).factory(b.modules.auth.services.authorization,["authentication",function(d){return{authorize:function(c,e,g){var h=b.modules.auth.enums.authorised.authorised,f=d.getCurrentLoginUser(),k=[],l=!0;g=g||b.modules.auth.enums.permissionCheckType.atLeastOne;if(!0===c&&void 0===f)h=b.modules.auth.enums.authorised.loginRequired;else if(!0===c&&void 0!==f&&(void 0===e||0===e.length))h=b.modules.auth.enums.authorised.authorised;else if(e){k=[];a.forEach(f.permissions,
function(a){k.push(a.toLowerCase())});for(h=0;h<e.length;h+=1)if(c=e[h].toLowerCase(),g===b.modules.auth.enums.permissionCheckType.combinationRequired){if(l=l&&-1<k.indexOf(c),!1===l)break}else if(g===b.modules.auth.enums.permissionCheckType.atLeastOne&&(l=-1<k.indexOf(c)))break;h=l?b.modules.auth.enums.authorised.authorised:b.modules.auth.enums.authorised.notAuthorised}return h}}}])})(angular,homer);(function(a,b){a.module(b.modules.auth.name).controller(b.modules.auth.controllers.login,["$rootScope","$scope","$location","$modal",b.modules.auth.services.authentication,b.modules.core.services.profile,function(a,c,e,g,h,f){c.loginModel={};c.isBusy=!1;c.invalidLogin=!1;a.loggedIn=!1;c.login=function(){console.log("Submiting user info.");c.invalidLogin=!1;c.isBusy=!0;h.login(c.loginModel.username,c.loginModel.password).then(function(g){c.isBusy=!1;1==g.isAuthenticated?(a.loggedIn=!0,console.log(f),
f.getAll(),e.path(b.modules.pages.routes.home)):c.invalidLogin=!0},function(){c.invalidLogin=!0})["finally"](function(){c.isBusy=!1})}}]);a.module(b.modules.auth.name).controller(b.modules.auth.controllers.logout,["$rootScope","$scope","$location",b.modules.auth.services.authentication,function(a,c,e,g){a.loggedIn=!1;g.logout().then(function(a){e.path(b.modules.auth.routes.login)},function(){e.path(b.modules.auth.routes.login)})}])})(angular,homer);(function(a,b){a.module(b.modules.auth.name).directive("access",[b.modules.auth.services.authorization,function(a){return{restrict:"A",link:function(c,e,g){c=g.access.split(",");0<c.length&&(e.removeClass("hidden"),a.authorize(!0,c,g.accessPermissionType)===b.modules.auth.enums.authorised.authorised?e.removeClass("hidden"):e.addClass("hidden"))}}}])})(angular,homer);(function(a,b){b.modules.admin={name:"admin",controllers:{users:"userListCtrl"},routes:{users:"/users"},state:{users:"users"}};defineHomerAngularModule(b.modules.admin.name,["ui.router"])})(angular,homer);(function(a,b){a.module(b.modules.admin.name).config(["$stateProvider","$urlRouterProvider",function(a,c){a.state(b.modules.admin.state.users,{url:b.modules.admin.routes.users,controller:b.modules.admin.controllers.users,templateUrl:"js/modules/admin/html/users.tmpl.html",access:{loginRequired:!0,permissions:["Admin"]}})}])})(angular,homer);(function(a,b){a.module(b.modules.admin.name).controller(b.modules.admin.controllers.users,[function(){}])})(angular,homer);(function(a,b){b.modules.pages={name:"pages",controllers:{"default":"defaultCtrl",search:"searchCtrl",result:"resultCtrl",dashboard:"dashboardCtrl",navigation:"navigationCtrl"},routes:{home:"/dashboard/home",search:"/dashboard/search",alarm:"/dashboard/alarm",result:"/result",dashboard:"/dashboard/:boardID"},events:{dashBoardChanged:"dashboard:item:changed",newDashboardItem:"dashboard:new:item",adfEvent:"adfDashboardChanged",adfDeleteEvent:"adfDashboardRequestedForDelete",widgetsReload:"widgetReload",
resultSearchSubmit:"resultSearchSubmit",hideLeftMenu:"hideLeftMenu",destroyRefresh:"destroyRefresh"},state:{home:"home",search:"search",result:"result",dashboard:"dashboard"}};b.modules.pages.instance=a.module(b.modules.pages.name,["ui.router"])})(angular,homer);(function(a,b){b.modules.pages.instance.config(["$stateProvider",function(a){a.state(b.modules.pages.state.home,{url:b.modules.pages.routes.home,controller:b.modules.pages.controllers.dashboard,controllerAs:"dashboard",templateUrl:"js/modules/pages/html/home.tmpl.html"});a.state(b.modules.pages.state.search,{url:b.modules.pages.routes.search,controller:b.modules.pages.controllers.dashboard,controllerAs:"dashboard",templateUrl:"js/modules/pages/html/search.tmpl.html"});a.state(b.modules.pages.state.result,
{url:b.modules.pages.routes.result,controller:b.modules.pages.controllers.result,templateUrl:"js/modules/pages/html/result.tmpl.html",resolve:{user:function(a,b){return b.getAll()}}});a.state(b.modules.pages.state.dashboard,{url:b.modules.pages.routes.dashboard,controller:b.modules.pages.controllers.dashboard,controllerAs:"dashboard",templateUrl:"js/modules/pages/html/dashboard.tmpl.html"})}])})(angular,homer);(function(a,b){a.module(b.modules.pages.name).controller(b.modules.pages.controllers["default"],["$location","$rootScope",b.modules.auth.services.authentication,function(a,c,e){0==c.loggedIn?(console.log("AUTH FALSE"),a.path(b.modules.auth.routes.login)):console.log("AUTH TRUE")}])})(angular,homer);(function(a,b){a.module(b.modules.pages.name).controller(b.modules.pages.controllers.search,["$scope","$rootScope","eventbus","$http","$location",b.modules.core.services.search,b.modules.core.services.store,function(a,c,e,g,h,f,k){a.expandme=!0;a.showtable=!1;0==c.loggedIn?(console.log("AUTH FALSE"),h.path(b.modules.auth.routes.login)):(console.log("AUTH TRUE"),a.colapseForm=function(){a.expandme=!a.expandme},a.removeForm=function(){a.expandme=!1},a.processSearchForm=function(c){a.showtable=!0;a.expandme=
!1;c=f.getTimeRange();c={timestamp:{from:c.fromdate.getTime(),to:c.todate.getTime()},param:{transaction:{call:!0,registration:!0,rest:!0},limit:100}};f.setSearchData(c);f.setSearchValue(f.searchValue);f.searchValue={};k.setProfile(null,[{name:"timestamp",value:c.timestamp},{name:"param",value:c.param}]).then(function(a){});e.broadcast(b.modules.pages.events.resultSearchSubmit,"fullsearch");h.path("/result")})}])})(angular,homer);(function(a,b){a.module(b.modules.pages.name).controller(b.modules.pages.controllers.result,["$scope","$rootScope","eventbus","$http","$location",b.modules.core.services.search,"$timeout","$window","$homerModal",b.modules.core.services.profile,function(d,c,e,g,h,f,k,l,n,m){d.expandme=!0;d.showtable=!0;d.dataLoading=!1;if(0==c.loggedIn)console.log("AUTH FALSE"),h.path(b.modules.auth.routes.login);else{console.log("AUTH TRUE");e.broadcast(b.modules.pages.events.hideLeftMenu,"1");d.$on("$destroy",function(){e.broadcast(b.modules.pages.events.destroyRefresh,
"1");q()});var q=e.subscribe(b.modules.pages.events.resultSearchSubmit,function(a,b,c){d.processSearchResult()});d.processSearchResult=function(){var b={param:{},timestamp:{}},c=m.getProfile("transaction"),e=m.getProfile("limit"),g=m.getProfile("timerange"),h=m.getProfile("search"),q=m.getProfile("node").dbnode;b.param.transaction={};b.param.limit=e;b.param.search=h;b.param.location={};b.param.location.node=q;b.timestamp.from=g.from.getTime();b.timestamp.to=g.to.getTime();a.forEach(c.transaction,
function(a,d){b.param.transaction[a.name]=!0});d.dataLoading=!0;f.searchByMethod(b).then(function(b){b&&(d.count=b.length,d.gridOpts.data=b,k(function(){a.element(l).resize()},0))},function(a){})["finally"](function(){d.dataLoading=!1})};d.processSearchResult();d.swapData=function(){};d.hashCode=function(a){for(var b=0,d=0;d<a.length;d++)b=a.charCodeAt(d)+((b<<5)-b);return b};d.intToARGB=function(a){return a>>24&255};d.getBkgColorTable=function(a){a=d.hashCode(a);return{"background-color":"hsl("+
d.intToARGB(a)+", 75%, 75%)"}};d.showMessage=function(a,b){var d={timestamp:{from:parseInt(a.entity.micro_ts/1E3),to:parseInt(a.entity.micro_ts/1E3)},param:{search:{id:parseInt(a.entity.id),callid:a.entity.callid},location:{node:a.entity.dbnode},transaction:{call:!1,registration:!1,rest:!1}}};d.param.transaction[a.entity.trans]=!0;n.open({url:"templates/dialogs/message.html",cls:"homer-modal-content",id:"message"+(""+a.entity.id+"_"+a.entity.trans).hashCode(),divLeft:b.clientX.toString()+"px",divTop:b.clientY.toString()+
"px",params:d,onOpen:function(){console.log("modal1 message opened from url "+this.id)},controller:"messageCtrl"})};d.getColumnValue=function(a,b){return void 0==a.entity[b.field+"_alias"]?a.entity[b.field+"_ip"]:a.entity[b.field+"_alias"]};d.getColumnTooltip=function(a,b){return a.entity[b.field+"_ip"]};d.showTransaction=function(b,c){var e=d.gridApi.selection.getSelectedRows(),f=[],g=[];f.push(b.entity.callid);a.forEach(e,function(a,b){-1==f.indexOf(a.callid)&&f.push(a.callid);-1==f.indexOf(a.callid_aleg)&&
1<a.callid_aleg.length&&f.push(a.callid_aleg);-1==g.indexOf(a.dbnode)&&g.push(a.dbnode)});var e={timestamp:{from:parseInt(b.entity.micro_ts/1E3)-300,to:parseInt(b.entity.micro_ts/1E3)+300},param:{search:{id:parseInt(b.entity.id),callid:f},location:{node:g},transaction:{call:!1,registration:!1,rest:!1}}},h=m.getProfile("timerange");e.timestamp.to=h.to.getTime();e.param.transaction[b.entity.trans]=!0;h=""+b.entity.callid+"_"+b.entity.dbnode;g=m.getProfile("node");e.param.location.node=g.dbnode;n.open({url:"templates/dialogs/transaction.html",
cls:"homer-modal-content",id:"trans"+h.hashCode(),params:e,divLeft:c.clientX.toString()+"px",divTop:c.clientY.toString()+"px",onOpen:function(){console.log("modal1 opened from url",this.id)},controller:"transactionCtrl"})};d.fileOneUploaded=!0;d.fileTwoUploaded=!1;d.gridOpts={enableColumnResizing:!0,enableSorting:!0,enableRowSelection:!0,enableGridMenu:!0,showGridFooter:!0,noUnselect:!1,multiSelect:!0,modifierKeysToMultiSelect:!1,enablePaging:!0,paginationPageSizes:[25,50,75,100,150,200,300,400,500,
600,800,1E3,2E3],paginationPageSize:25,enableFiltering:!0,rowTemplate:'<div ng-style="row.isSelected && {} || grid.appScope.getBkgColorTable(row.entity.callid)"><div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell></div></div>',filterOptions:{filterText:"",useExternalFilter:!1},columnDefs:[{field:"id",displayName:"Id",width:50},{field:"milli_ts",displayName:"Date",
cellFilter:"date:'yyyy-dd-MM HH:mm:ss.sss'",width:170},{field:"method",displayName:"Method",cellClass:function(a,b,d,c,e){if("INVITE"===a.getCellValue(b,d))return"blue"},cellTemplate:'<div  ng-click="grid.appScope.showMessage(row, $event)" class="ui-grid-cell-contents"><span class="navText">{{COL_FIELD}}</span></div>'},{field:"reply_reason",displayName:"Reason",width:70},{field:"ruri_user",displayName:"RURI user"},{field:"from_user",displayName:"From User"},{field:"callid",displayName:"CallID",width:160,
cellTemplate:'<div  ng-click="grid.appScope.showTransaction(row, $event)" class="ui-grid-cell-contents"><span class="navText">{{COL_FIELD}}</span></div>'},{field:"callid_aleg",displayName:"CallID_AL",width:100,cellTemplate:'<div  ng-click="grid.appScope.showTransaction(row, $event)" class="ui-grid-cell-contents"><span class="navText">{{COL_FIELD}}</span></div>'},{field:"user_agent",displayName:"User Agent"},{field:"source",displayName:"Source Host",cellTemplate:'<div title="{{ grid.appScope.getColumnTooltip(row, col) }}">{{ grid.appScope.getColumnValue(row, col) }}</div>'},
{field:"source_port",displayName:"SPort",width:50},{field:"destination",displayName:"Destination Host",cellTemplate:'<div title="{{ grid.appScope.getColumnTooltip(row, col) }}">{{ grid.appScope.getColumnValue(row, col) }}</div>'},{field:"destination_port",displayName:"DPort",width:50},{field:"proto",displayName:"Proto",width:40},{field:"node",displayName:"Node"}]};d.gridOpts.rowIdentity=function(a){return a.id};d.gridOpts.onRegisterApi=function(a){d.gridApi=a}}}]).filter("unixts",function(){return function(a){return a?
new Date(1E3*a):""}})})(angular,homer);(function(a,b){a.module(b.modules.pages.name).controller("drawCtrl",function(a,b){console.log("OPEN DATA");a.ok=function(){b.close("11")};a.close=function(){b.dismiss("cancel")}}).controller("messageCtrl",["$scope",b.modules.core.services.search,"$homerModal","$timeout","$homerModalParams","$sce",function(a,b,e,g,h,f){h=h.params;a.dataLoading=!0;a.showSipMessage=!0;a.showSipDetails=!1;a.clickSipDetails=function(){console.log("details")};b.searchMethod(h).then(function(b){a.msgId=b[0].id;a.msgCallId=
b[0].callid;a.msgDate=b[0].date;a.sipPath=b[0].source_ip+":"+b[0].source_port+" -> "+b[0].destination_ip+":"+b[0].destination_port;var c;c=b[0].msg;var e,g;c=c.split("<").join("&lt;");e=b[0].method;g="<font color='red'><b>"+e+"</b></font>";c=c.split(e).join(g);e=b[0].callid;g="<font color='blue'><b>"+e+"</b></font>";c=c.split(e).join(g);e=b[0].from_tag;g="<font color='red'><b>"+e+"</b></font>";c=c.split(e).join(g);e=b[0].via_1_branch;g="<font color='green'><b>"+e+"</b></font>";c=c.split(e).join(g);
c=f.trustAsHtml(c);a.sipMessage=c;c=[];for(var h in b[0])"msg"!=h&&b[0].hasOwnProperty(h)&&""!=b[0][h]&&c.push(""+h+": <b>"+b[0][h].split("<").join("&lt;")+"</b><br>");c.push();a.sipDetails="<div id='"+b[0].id+"_details'>"+c.join("")+"</div>";a.trustedHtmlDetails=f.trustAsHtml(a.sipDetails)},function(a){console.log(a)})["finally"](function(){a.dataLoading=!1});g(function(){-1!==e.getOpenedModals().indexOf("tempModal")&&e.close("tempModal","var a","var b")},5E3)}]).controller("transactionCtrl",["$scope",
b.modules.core.services.search,"$homerModal","$homerCflow","$timeout","$homerModalParams","$sce",function(b,c,e,g,h,f,k){var l=f.params;b.data=l;b.dataLoading=!0;b.showSipMessage=!0;b.showSipDetails=!1;b.clickSipDetails=function(){console.log("details")};b.id=f.id;b.transaction=[];b.clickArea=[];b.msgCallId=f.params.param.search.callid[0];b.collapsed=[];b.enableQualityReport=!1;b.enableRTCPReport=!1;b.enableLogReport=!1;b.enableXRTPReport=!1;var n=function(){var a=defineExportTemplate(),c=new Date(b.transaction.calldata[0].milli_ts),
c=c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds(),a=a.replace("#{date}",c);return a=$.tmpl(a,b.transaction.calldata[0])};b.exportCanvas=function(){var b=a.element(document.querySelectorAll("#"+f.id)),b=$(b).find("#cflowcanv"),d=document.createElement("a");d.download=n()+".png";d.href=b[0].toDataURL("image/png");d.click()};b.exportPCAP=function(){m(this.data,!1,b.msgCallId)};b.exportTEXT=function(){m(this.data,!0,b.msgCallId)};b.exportShare=
function(){b.sharelink="";c.createShareLink(l).then(function(a){a&&(b.sharelink=a[0])},function(a){})["finally"](function(){})};b.toggleTree=function(a){b.collapsed[a]=!b.collapsed[a]};b.drawCanvas=function(a,c){b.clickArea=g.setContext(a,c)};b.showMessage=function(a,b){var d={timestamp:{from:parseInt(a.micro_ts/1E3),to:parseInt(a.micro_ts/1E3)},param:{search:{id:parseInt(a.id),callid:a.callid},location:{node:a.dbnode},transaction:{call:!1,registration:!1,rest:!1}}};d.param.transaction[a.trans]=!0;
e.open({url:"templates/dialogs/message.html",cls:"homer-modal-content",id:"message"+(""+a.id+"_"+a.trans).hashCode(),divLeft:b.clientX.toString()+"px",divTop:b.clientY.toString()+"px",params:d,onOpen:function(){console.log("modal1 message opened from url "+this.id)},controller:"messageCtrl"})};b.checkMousePosition=function(c){var e=!1,f=null==c.offsetX?c.originalEvent.layerX-c.target.offsetLeft:c.offsetX,g=null==c.offsetY?c.originalEvent.layerY-c.target.offsetTop:c.offsetY;a.forEach(b.clickArea,function(a){a.x1<
f&&a.x2>f&&a.y1<g&&a.y2>g&&(e=!0)});return e};b.clickMousePosition=function(c){var e=!1,f={},g=null==c.offsetX?c.originalEvent.layerX-c.target.offsetLeft:c.offsetX,h=null==c.offsetY?c.originalEvent.layerY-c.target.offsetTop:c.offsetY;a.forEach(b.clickArea,function(a){a.x1<g&&a.x2>g&&a.y1<h&&a.y2>h&&(e=!0,f=a)});e&&("host"==f.type?console.log("clicked on host"):"message"==f.type&&b.showMessage(f.data,c));return e};b.reDrawCanvas=function(){b.drawCanvas(b.id,b.transaction)};c.searchTransaction(l).then(function(a){a&&
(b.transaction=a,b.drawCanvas(f.id,a),0<a.rtpinfo.length&&(b.enableXRTPReport=!0,b.xrtpreport=a.rtpinfo))},function(a){})["finally"](function(){b.dataLoading=!1});b.showRTCPReport=function(a){c.searchRTCPReport(a).then(function(a){0<a.length&&(console.log("RTCP",a),b.enableRTCPReport=!0,b.rtcpreport=a)},function(a){})["finally"](function(){b.dataLoading=!1})};b.showLogReport=function(a){c.searchLogReport(a).then(function(a){0<a.length&&(b.enableLogReport=!0,b.logreport=a)},function(a){})["finally"](function(){b.dataLoading=
!1})};b.showQualityReport=function(a){c.searchQualityReport("short",a).then(function(a){0<a.length&&(b.enableQualityReport=!0,b.qualityreport=a)},function(a){})["finally"](function(){b.dataLoading=!1})};b.showRTCPReport(l);b.showLogReport(l);b.showQualityReport(l);console.log("Reporting...",l);var m=function(a,b,d){c.makePcapTextforTransaction(a,b).then(function(a){var c=n()+".pcap",d="application/pcap";b&&(c=n()+".txt",d="attacment/text;charset=utf-8");a=new Blob([a],{type:d});saveAs(a,c)},function(a){})["finally"](function(){})};
h(function(){-1!==e.getOpenedModals().indexOf("tempModal")&&e.close("tempModal","var a","var b")},5E3);b.treedata2=[{id:1,title:"node1",nodes:[{id:11,title:"node1.1",nodes:[{id:111,title:"node1.1.1",nodes:[]}]},{id:12,title:"node1.2",nodes:[]}]},{id:2,title:"node2",nodes:[{id:21,title:"node2.1",nodes:[]},{id:22,title:"node2.2",nodes:[]}]},{id:3,title:"node3",nodes:[{id:31,title:"node3.1",nodes:[]}]}]}])})(angular,homer);(function(a,b){a.module(b.modules.pages.name).controller(b.modules.pages.controllers.navigation,["$scope","$location","$rootScope","eventbus",b.modules.auth.services.authentication,b.modules.core.services.store,function(a,c,e,g,h,f){a.showChilds=function(a){console.log(a);a.active=!a.active};a.addNewDashboard=function(b){var c="_"+(new Date).getTime();f.set(c,{title:b,structure:"4-8",rows:[{columns:[{styleClass:"col-md-4",widgets:[]},{styleClass:"col-md-8",widgets:[]}]}]});f.getAll().then(function(b){a.items=
b.data;a.items[2].active=!0;console.log(a.items[2])},function(){})["finally"](function(){})};g.subscribe(b.modules.pages.events.newDashboardItem,function(b,c){a.addNewDashboard(c)});g.subscribe(b.modules.pages.events.dashBoardChanged,function(b,c){f.getAll().then(function(b){console.log(b.data);a.items=b.data;a.items[2].active=!0},function(){})["finally"](function(){})});f.getAll().then(function(b){a.items=b.data},function(){})["finally"](function(){})}])})(angular,homer);(function(a,b){a.module(b.modules.pages.name).controller(b.modules.pages.controllers.dashboard,["$scope","$state","$stateParams","$location","$rootScope","eventbus",b.modules.auth.services.authentication,b.modules.core.services.store,"SweetAlert",function(a,c,e,g,h,f,k,l,n){if(0==h.loggedIn)console.log("AUTH FALSE DASHBOARD"),g.path(b.modules.auth.routes.login);else{console.log("AUTH TRUE DASHBOARD");"search"==c.current.name?e.boardID="search":"home"==c.current.name?e.boardID="home":"alarm"==c.current.name&&
(e.boardID="alarm");this.name=e.boardID;var m=this;l.get(e.boardID).then(function(a){m.model=a});this["delete"]=function(a){n.swal({title:"Are you sure?",text:"Your will not be able to recover this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(c){c&&(l["delete"](a),g.path("/home"),f.broadcast(b.modules.pages.events.dashBoardChanged,a))})};f.subscribe(b.modules.pages.events.adfEvent,function(a,c,d){l.set(c,
d);a=!1;var e="",g="",h=10,k="";d.hasOwnProperty("protect")&&(a=d.protect);d.hasOwnProperty("title")&&(g=d.title);d.hasOwnProperty("weight")&&(h=d.weight);d.hasOwnProperty("alias")&&(k=d.alias);d.hasOwnProperty("selectedItem")&&(e=d.selectedItem);l.menu(c,{param:{protect:a,title:g,weight:h,alias:k,icon:e}}).then(function(a){console.log("update")},function(){console.log("wrong reply")})["finally"](function(){f.broadcast(b.modules.pages.events.dashBoardChanged,c)})});f.subscribe(b.modules.pages.events.adfDeleteEvent,
function(a,b){m["delete"](b)})}}])})(angular,homer);(function(a,b){a.module(b.modules.pages.name).directive("resize",function(b){return function(c,e){var g=a.element(b);c.getWindowDimensions=function(){return{h:g.height(),w:g.width()}};c.$watch(c.getWindowDimensions,function(a,b){$(".gridStyle").height(a.h-180)},!0);g.bind("resize",function(){c.$apply()})}}).directive("afterRender",["$window","$timeout",function(a){return{restrict:"A",terminal:!0,transclude:!1,link:function(a,b,d){d&&a.$eval(d.afterRender);a.$emit("onAfterRender")}}}]).directive("modal",
function(){return{template:'<div class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">{{ title }}</h4></div><div class="modal-body" ng-transclude></div></div></div></div>',restrict:"E",transclude:!0,replace:!0,scope:!0,link:function(a,b,e){a.title=e.title;a.$watch(e.visible,function(a){1==a?$(b).modal("show"):$(b).modal("hide")});$(b).on("shown.bs.modal",
function(){a.$apply(function(){a.$parent[e.visible]=!0})});$(b).on("hidden.bs.modal",function(){a.$apply(function(){a.$parent[e.visible]=!1})})}}}).directive("draggable",function(){return{restrict:"EA",link:function(a,b){$(b).draggable({cancel:".homer-modal-body, .close",handle:".homer-modal-header"}).resizable({resize:function(e,g){var h=$(b).find("#cflowcanv");0<$(h).length&&a.reDrawCanvas();h=$(b).find(".homer-modal-body");$(h).width(g.size.width-10);$(h).height(g.size.height-50)}})}}})})(angular,
homer);angular.module("homer.widgets.sipcapture",["adf.provider","highcharts-ng"]).value("localApiUrl","api/v1/").value("sipcaptureApiUrl","api/v1/").config(function(a){a.widget("sipcaptureChart",angular.extend({title:"SIPCapture Charts",description:"Display SIPCapture API data as charts",controller:"sipcaptureCtrl"},{templateUrl:"js/widgets/sipcapture/sipcapture.html",reload:!0,resolve:{sipdata:function(a,d,c){if(c.path&&c.query)return d.get(c,c.path,c.query)}},edit:{templateUrl:"js/widgets/sipcapture/edit.html",
controller:"sipcaptureEditController"},refresh:!0}))}).service("sipcaptureService",function(a,b,d,c){return{get:function(e,g,h){var f=a.defer();g=d+g;var k={};try{if(k=JSON.parse(h),!k.timestamp)return f.reject(),f.promise}catch(l){return f.reject(),f.promise}h=c.getProfile("timerange");k.timestamp.from=h.from.getTime();k.timestamp.to=h.to.getTime();b.post(g,k).success(function(a){e.debugresp=JSON.stringify(a);a&&a.status&&(300>a.status?f.resolve(a.data):f.reject(a.data))}).error(function(){f.reject()});
return f.promise}}}).controller("sipcaptureCtrl",function(a,b,d,c){function e(c){var d={};angular.forEach(c,function(a){var c=1E3*a[b.panel.timefield],e=[];angular.forEach(g,function(b){e.push(a[b])});var f=e.join("|"),k=0;angular.forEach(h,function(b){k=parseInt(a[b])});d.hasOwnProperty(f)||(d[f]=[]);d[f].push([c,k])});var e=[];"pie"==b.chart.type.value?(e.push({type:b.chart.type.value,name:a.$parent.model.title,data:[]}),angular.forEach(d,function(a,b){var c=0;angular.forEach(a,function(a){c+=a[1]});
e[0].data.push([b,c])})):angular.forEach(d,function(a,c){var d={};d.name=c;d.type=b.chart.type.value;a.sort(function(a,b){return a[0]-b[0]});d.data=a;e.push(d)});return e}var g=b.panel.fieldname.split(";"),h=b.panel.fieldvalue.split(";");a.reloadIt=function(){a.$parent.changeReloading(!0);c.get(b,b.path,b.query).then(function(b){b=e(b);for(var c=a.chartObj,d=b.length,f=0,g=c.series.length;f<g;f++)f<d?c.series[f].update(b[f],!0):c.series[f]&&c.series[f].remove(!1);for(f;f<d;f++)c.addSeries(b[f],!0);
a.$parent.changeReloading(!1)},function(a){console.log("RZ");console.log(a)})};var f=e(d);d&&("pie"==b.chart.type.value?(a.chartConfig={chart:{type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.$parent.model.title,style:{display:"none"}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:0,dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},showInLegend:!1}},series:f},b.chart.ccc&&(d=[],
d=b.chart.ccc.split(","),a.chartConfig.hasOwnProperty("colors")||(a.chartConfig.colors=[]),a.chartConfig.colors=d,console.log("CCOLOR-PIE:",a.chartConfig)),b.chart.ddd&&(a.chartConfig.chart.options3d={enabled:!0,alpha:45,beta:0},a.chartConfig.plotOptions.pie.depth=35),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&(a.chartConfig.size.width=b.chart.size.width),0<parseInt(b.chart.size.height)&&(a.chartConfig.size.height=b.chart.size.height)),
b.chart.legend&&b.chart.legend.enabled&&1==b.chart.legend.enabled&&(a.chartConfig.plotOptions.pie.showInLegend=b.chart.legend.enabled,a.chartConfig.plotOptions.pie.dataLabels.enabled=!1)):(a.chartConfig={chart:{type:b.chart.type.value},title:{text:a.$parent.model.title,style:{display:"none"}},xAxis:{type:"datetime"},yAxis:{title:{text:null},min:0},plotOptions:{column:{}},tooltip:{},legend:{enabled:!1,borderWidth:0},series:f},a.chartConfig.chart.zoomType="x",a.chartConfig.tooltip.crosshairs=!0,a.chartConfig.tooltip.shared=
!0,b.chart.ccc&&(d=[],d=b.chart.ccc.split(","),a.chartConfig.colors=d),b.chart.sss&&(d=b.chart.type.value,a.chartConfig.plotOptions[d]={},a.chartConfig.plotOptions[d].stacking=b.chart.ppp?"percent":"normal"),b.chart.ddd&&(a.chartConfig.chart.options3d={enabled:!0,alpha:15,beta:10,depth:50,viewDistance:30},a.chartConfig.plotOptions.column.depth=25,a.chartConfig.chart.margin=60),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&(a.chartConfig.size.width=
b.chart.size.width),0<parseInt(b.chart.size.height)&&(a.chartConfig.size.height=b.chart.size.height)),b.chart.legend&&(b.chart.legend.align&&(a.chartConfig.legend.align=b.chart.legend.align),b.chart.legend.enabled&&(a.chartConfig.legend.enabled=b.chart.legend.enabled),b.chart.legend.layout&&(a.chartConfig.legend.layout=b.chart.legend.layout)),b.chart.yaxis&&b.chart.yaxis.title&&0<b.chart.yaxis.title.length&&(a.chartConfig.yAxis.title.text=b.chart.yaxis.title)))}).controller("sipcaptureEditController",
function(a,b,d,c){a.charts=[{id:1,label:"Spline",value:"spline"},{id:2,label:"Line",value:"line"},{id:3,label:"Area spline",value:"areaspline"},{id:4,label:"Bar",value:"bar"},{id:5,label:"Scatter",value:"scatter"},{id:6,label:"Pie",value:"pie"},{id:7,label:"Column",value:"column"},{id:8,label:"Gauge",value:"solidgauge"},{id:9,label:"Heatbox",value:"heatmap"}];a.legend_align=[{name:"center",value:"center"},{name:"right",value:"right"},{name:"left",value:"left"}];a.legend_layout=[{name:"horizontal",
value:"horizontal"},{name:"vertical",value:"vertical"}];a.updateDebugUrl=function(){var e=d+a.config.path;try{var g=JSON.parse(a.config.query),h=c.getProfile("timerange");g.timestamp.from=h.from.getTime();g.timestamp.to=h.to.getTime();a.debug="curl -v --cookie 'HOMERSESSID="+b.HOMERSESSID+"' -X POST \\\n-d '"+JSON.stringify(g)+"' \\\n \""+window.location.protocol+"//"+window.location.host+"/"+e+'"\n';a.parsingStatus="ok";a.parsingColorClass="green"}catch(f){a.parsingStatus="Bad parsing: ["+f.message+
"]",a.parsingColorClass="red"}};a.updateDebugUrl()});angular.module("homer.widgets.querycap",["adf.provider","highcharts-ng"]).value("localApiUrl","api/v1/").value("querycapApiUrl","http://homer.yourhost.org:8086").config(function(a){a.widget("querycapChart",angular.extend({title:"QueryCapture Charts",description:"Display QueryCapture API data as charts",controller:"querycapCtrl"},{templateUrl:"js/widgets/querycap/querycap.html",reload:!0,resolve:{sipdata:function(a,d,c){c.query||(c.query='select * from "homer.stats.counters.polycomMos.count" where time > $fromts AND time < $tots;');
c.path||(c.path="http://127.0.0.1:8086/query");c.db||(c.db={});c.db.user||(c.db.user="root");c.db.password||(c.db.password="root");c.db.name||(c.db.name="homer_stats");c.source||(c.source={});c.source.main||(c.source.main="results");c.source.sub||(c.source.sub="series");c.panel||(c.panel={});c.panel.timefield||(c.panel.timefield="time");c.panel.fieldname||(c.panel.fieldname="name");c.panel.fieldvalue||(c.panel.fieldvalue="value");c.chart.maxvalue||(c.chart.maxvalue=0);if(c.path&&c.query&&c.db)return d.get(c,
c.path,c.query)}},edit:{templateUrl:"js/widgets/querycap/edit.html",controller:"querycapEditController"},refresh:!0}))}).service("querycapService",function(a,b,d,c){return{get:function(d,g,h){var f=a.defer(),k=c.getProfile("timerange");h=h.replace(/\$fromts/g,1E3*k.from.getTime()+"u");h=h.replace(/\$tots/g,1E3*k.to.getTime()+"u");g=g+"?u="+d.db.user+"&p="+d.db.password+"&db="+d.db.name+"&q="+encodeURIComponent(h);b.defaults.useXDomain=!0;delete b.defaults.headers.common.Authorization;b.get(g).success(function(a){var b=
a.results;d.source&&d.source.main&&(b=a[d.source.main]);f.resolve(b)}).error(function(){f.reject()});return f.promise}}}).controller("querycapCtrl",function(a,b,d,c,e){function g(c){var d={};angular.forEach(c,function(a){var c=a.series;b.source.sub&&(c=a[b.source.sub]);angular.forEach(c,function(a){var c=a.name;b.panel.fieldname&&(c=a[b.panel.fieldname]);angular.forEach(a.values,function(a){var e=(new Date(a[0])).getTime();a=a[1];0<b.panel.fielddivide&&(a/=b.panel.fielddivide);d.hasOwnProperty(c)||
(d[c]=[]);0<b.chart.maxvalue&&b.chart.maxvalue<a&&(a=b.chart.maxvalue);d[c].push([e,a])})})});var e=[];"pie"==b.chart.type.value?(e.push({type:b.chart.type.value,name:a.$parent.model.title,data:[]}),angular.forEach(d,function(a,b){var c=0;angular.forEach(a,function(a){c+=a[1]});e[0].data.push([b,c])})):angular.forEach(d,function(a,c){var d={};d.name=c;d.type=b.chart.type.value;a.sort(function(a,b){return a[0]-b[0]});d.data=a;e.push(d)});return e}b.panel.fieldname.split(";");b.panel.fieldvalue.split(";");
a.reloadIt=function(){a.$parent.changeReloading(!0);c.get(b,b.path,b.query).then(function(b){b=g(b);for(var c=a.chartObj,d=b.length,e=0,n=c.series.length;e<n;e++)e<d?c.series[e].update(b[e],!0):c.series[e]&&c.series[e].remove(!1);for(e;e<d;e++)c.addSeries(b[e],!0);a.$parent.changeReloading(!1)},function(a){})};e=g(d);d&&("pie"==b.chart.type.value?(a.chartConfig={chart:{type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.$parent.model.title,style:{display:"none"}},
plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:0,dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},showInLegend:!1}},series:e},b.chart.ccc&&(d=[],d=b.chart.ccc.split(","),a.chartConfig.hasOwnProperty("colors")||(a.chartConfig.colors=[]),a.chartConfig.colors=d),b.chart.ddd&&(a.chartConfig.chart.options3d={enabled:!0,alpha:45,beta:0},a.chartConfig.plotOptions.pie.depth=35),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||
(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&(a.chartConfig.size.width=b.chart.size.width),0<parseInt(b.chart.size.height)&&(a.chartConfig.size.height=b.chart.size.height)),b.chart.legend&&b.chart.legend.enabled&&1==b.chart.legend.enabled&&(a.chartConfig.plotOptions.pie.showInLegend=b.chart.legend.enabled,a.chartConfig.plotOptions.pie.dataLabels.enabled=!1)):(a.chartConfig={chart:{type:b.chart.type.value},title:{text:a.$parent.model.title,style:{display:"none"}},xAxis:{type:"datetime"},
yAxis:{title:{text:null},min:0},plotOptions:{column:{}},legend:{enabled:!1,borderWidth:0},series:e},b.chart.ccc&&(d=[],d=b.chart.ccc.split(","),a.chartConfig.hasOwnProperty("colors")||(a.chartConfig.colors=[]),a.chartConfig.colors=d),b.chart.sss&&(d=b.chart.type.value,a.chartConfig.plotOptions[d]={},a.chartConfig.plotOptions[d].stacking=b.chart.ppp?"percent":"normal"),b.chart.ddd&&(a.chartConfig.chart.options3d={enabled:!0,alpha:15,beta:10,depth:50,viewDistance:30},a.chartConfig.plotOptions.column.depth=
25,a.chartConfig.chart.margin=60),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&(a.chartConfig.size.width=b.chart.size.width),0<parseInt(b.chart.size.height)&&(a.chartConfig.size.height=b.chart.size.height)),b.chart.legend&&(b.chart.legend.align&&(a.chartConfig.legend.align=b.chart.legend.align),b.chart.legend.enabled&&(a.chartConfig.legend.enabled=b.chart.legend.enabled),b.chart.legend.layout&&(a.chartConfig.legend.layout=b.chart.legend.layout)),
b.chart.yaxis&&b.chart.yaxis.title&&0<b.chart.yaxis.title.length&&(a.chartConfig.yAxis.title.text=b.chart.yaxis.title)))}).controller("querycapEditController",function(a,b,d,c){a.charts=[{id:1,label:"Spline",value:"spline"},{id:2,label:"Line",value:"line"},{id:3,label:"Area spline",value:"areaspline"},{id:4,label:"Bar",value:"bar"},{id:5,label:"Scatter",value:"scatter"},{id:6,label:"Pie",value:"pie"},{id:7,label:"Column",value:"column"}];a.legend_align=[{name:"center",value:"center"},{name:"right",
value:"right"},{name:"left",value:"left"}];a.legend_layout=[{name:"horizontal",value:"horizontal"},{name:"vertical",value:"vertical"}];a.updateDebugUrl=function(){if(a.config&&a.config.query&&a.config.path&&a.config.db){var b=a.config.query,d=c.getProfile("timerange"),b=b.replace(/\$fromts/g,1E3*d.from.getTime()+"u"),b=b.replace(/\$tots/g,1E3*d.to.getTime()+"u");a.debug="curl -v -X GET '"+(a.config.path+"?u="+a.config.db.user+"&p="+a.config.db.password+"&db="+a.config.db.name+"&q="+b)+"'\n";a.parsingStatus=
"ok";a.parsingColorClass="green"}};a.updateDebugUrl()});angular.module("homer.widgets.elasticap",["adf.provider","highcharts-ng","base64"]).value("localApiUrl","api/v1/").value("elasticapApiUrl","http://homer.sipcapture.org:8086").config(function(a){a.widget("elasticapChart",angular.extend({title:"Elastic Facets",description:"Display Elasticsearch Facets",controller:"elasticapCtrl"},{templateUrl:"js/widgets/elasticap/elasticap.html",reload:!0,resolve:{sipdata:function(a,d,c){if(c.path&&c.query)return d.get(c,c.path,c.query)}},edit:{templateUrl:"js/widgets/elasticap/edit.html",
controller:"elasticapEditController"},refresh:!0}))}).service("elasticapService",function(a,b,d,c,e){return{get:function(d,h,f){var k=a.defer(),l=c.getProfile("timerange");f=f.replace(/"\$fromts"/g,l.from.getTime());f=f.replace(/"\$tots"/g,l.to.getTime());f="undefined"!==typeof d.query_string&&-1<d.query_string.indexOf('"')?f.replace(/"\$query"/g,d.query_string):f.replace(/"\$query"/g,'"'+d.query_string+'"');d.db.user&&-1===h.indexOf("@")&&(console.log("ES: Custom HTTP authentication"),b.defaults.headers.common.Authorization=
"Basic "+e.encode(d.db.password?d.db.user+":"+d.db.password:d.db.user+":"));console.log("ES-URL:",h);f=JSON.parse(f);console.log("ES-QUERY",f);b.post(h,f).success(function(a){d.debugresp=JSON.stringify(a);"histogram"===d.chart.query_type?(console.log("ES: FACETS"),k.resolve(a.facets[0].entries)):"terms"===d.chart.query_type?(console.log("ES: FACET TERMS"),k.resolve(a.facets.terms.terms)):"hits"===d.chart.query_type?(console.log("ES: HITS"),k.resolve(a.hits.hits)):k.reject()}).error(function(){console.log("ES ERROR");
k.reject()});return k.promise}}}).controller("elasticapCtrl",function(a,b,d,c){function e(c){var d={},e=b.panel.fieldname.split(";"),k=b.panel.fieldvalue.split(";");angular.forEach(c,function(a){var c=a[b.panel.timefield],g=[];angular.forEach(e,function(a){g.push(a)});var l=g.join("|"),p=0;angular.forEach(k,function(e){b.panel.fieldsum?(d.hasOwnProperty(l)||(d[l]=[]),p=a[e],d[l][1]=p):(d.hasOwnProperty(l)||(d[l]=[]),p=a[e],d[l].push([c,p]))})});var l=[];"pie"==b.chart.type.value?(l.push({type:b.chart.type.value,
name:a.$parent.model.title,data:[]}),angular.forEach(d,function(a,b){var d=0;angular.forEach(a,function(a){d+=a[1]});l[0].data.push([b,d])})):angular.forEach(d,function(a,d){a.sort(function(a,b){return a[0]-b[0]});l.push({name:d,type:b.chart.type.value,data:a})});console.log("ES-SERIES-DATA:",l);return l}b.panel&&(b.panel.fieldname.split(";"),b.panel.fieldvalue.split(";"),a.reloadIt=function(){a.$parent.changeReloading(!0);c.get(b,b.path,b.query).then(function(b){b=e(b);var d=a.chartObj;if("undefined"!==
typeof d.series){for(var c=b.length,k=0,l=d.series.length;k<l;k++)k<c?d.series[k].update(b[k],!0):d.series[k]&&d.series[k].remove(!1);for(k;k<c;k++)d.addSeries(b[k],!0);a.$parent.changeReloading(!1)}},function(a){})},d&&(d=e(d),"pie"==b.chart.type.value?(a.chartConfig={chart:{type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.$parent.model.title,style:{display:"none"}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:0,dataLabels:{enabled:!0,color:"#000000",
connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},showInLegend:!1}},series:d},b.chart.ccc&&(d=[],d=b.chart.ccc.split(","),a.chartConfig.hasOwnProperty("colors")||(a.chartConfig.colors=[]),a.chartConfig.colors=d,console.log("CCOLOR-PIE:",a.chartConfig)),b.chart.ddd&&(a.chartConfig.chart.options3d={enabled:!0,alpha:45,beta:0},a.chartConfig.plotOptions.pie.depth=35),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&
(a.chartConfig.size.width=b.chart.size.width),0<parseInt(b.chart.size.height)&&(a.chartConfig.size.height=b.chart.size.height)),b.chart.legend&&b.chart.legend.enabled&&1==b.chart.legend.enabled&&(a.chartConfig.plotOptions.pie.showInLegend=b.chart.legend.enabled,a.chartConfig.plotOptions.pie.dataLabels.enabled=!1)):(a.chartConfig={chart:{type:b.chart.type.value},title:{text:a.$parent.model.title,style:{display:"none"}},xAxis:{type:"datetime"},yAxis:{title:{text:null},min:0},plotOptions:{column:{}},
legend:{enabled:!1,borderWidth:0},series:d},"terms"===b.chart.query_type&&(console.log("ES-TERMS!"),a.chartConfig.xAxis.type=void 0,a.chartConfig.xAxis.categories=[],angular.forEach(d,function(b){angular.forEach(b.data,function(b){a.chartConfig.xAxis.categories.push([b[0]])})}),"undefined"!==typeof a.chartConfig.series[0]&&(a.chartConfig.series[0].colorByPoint=!0)),b.chart.ccc&&(d=[],d=b.chart.ccc.split(","),a.chartConfig.hasOwnProperty("colors")||(a.chartConfig.colors=[]),a.chartConfig.colors=d),
b.chart.sss&&(d=b.chart.type.value,a.chartConfig.plotOptions[d]={},a.chartConfig.plotOptions[d].stacking=b.chart.ppp?"percent":"normal"),b.chart.ddd&&(a.chartConfig.chart.options3d={enabled:!0,alpha:15,beta:10,depth:50,viewDistance:30},a.chartConfig.plotOptions.column.depth=25,a.chartConfig.chart.margin=60),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&(a.chartConfig.size.width=b.chart.size.width),0<parseInt(b.chart.size.height)&&(a.chartConfig.size.height=
b.chart.size.height)),b.chart.legend&&(b.chart.legend.align&&(a.chartConfig.legend.align=b.chart.legend.align),b.chart.legend.enabled&&(a.chartConfig.legend.enabled=b.chart.legend.enabled),b.chart.legend.layout&&(a.chartConfig.legend.layout=b.chart.legend.layout)),b.chart.yaxis&&b.chart.yaxis.title&&0<b.chart.yaxis.title.length&&(a.chartConfig.yAxis.title.text=b.chart.yaxis.title))))}).controller("elasticapEditController",function(a,b,d,c){a.charts=[{id:1,label:"Spline",value:"spline"},{id:2,label:"Line",
value:"line"},{id:3,label:"Area spline",value:"areaspline"},{id:4,label:"Bar",value:"bar"},{id:5,label:"Scatter",value:"scatter"},{id:6,label:"Pie",value:"pie"},{id:7,label:"Column",value:"column"}];a.query_type=[{name:"",value:""},{name:"Terms",value:"terms"},{name:"Hits",value:"hits"},{name:"Histogram",value:"histogram"}];a.query_res=[{name:"1 Minute",value:"1m"},{name:"5 Minutes",value:"5m"},{name:"15 Minutes",value:"15m"},{name:"30 Minutes",value:"30m"},{name:"60 Minutes",value:"1h"}];a.legend_align=
[{name:"center",value:"center"},{name:"right",value:"right"},{name:"left",value:"left"}];a.legend_layout=[{name:"horizontal",value:"horizontal"},{name:"vertical",value:"vertical"}];a.updateDebugUrl=function(){if(a.config&&a.config.query&&a.config.path&&a.config.db)try{JSON.parse(a.config.query);var b=c.getProfile("timerange"),d=a.config.query,d=d.replace(/"\$fromts"/g,b.from.getTime()),d=d.replace(/"\$tots"/g,b.to.getTime()),d="undefined"!==typeof a.config_query&&-1<a.config.query_string.indexOf('"')?
d.replace(/"\$query"/g,a.config.query_string):d.replace(/"\$query"/g,'"'+a.config.query_string+'"'),h=a.config.path,b="";a.config.db.user&&(b="-U "+a.config.db.user);a.config.db.password&&(b+=":"+a.config.db.password);a.debug="curl -v -X GET "+b+" '"+h+"' -d '"+d+"\n";a.parsingStatus="ok";a.parsingColorClass="green"}catch(f){a.parsingStatus="Bad parsing: ["+f.message+"]",a.parsingColorClass="red"}};a.updateDebugUrl()});angular.module("adf.widgets.linklist",["adf.provider"]).config(function(a){a.widget("linklist",{title:"Links",description:"Displays a list of links",controller:"linklistCtrl",controllerAs:"list",templateUrl:"js/widgets/linklist/linklist.html",edit:{templateUrl:"js/widgets/linklist/edit.html",reload:!1,controller:"linklistEditCtrl"}})}).controller("linklistCtrl",function(a,b){b.links||(b.links=[]);this.links=b.links}).controller("linklistEditCtrl",function(a){function b(){a.config.links||(a.config.links=
[]);return a.config.links}a.addLink=function(){b().push({})};a.removeLink=function(a){b().splice(a,1)}});angular.module("homer.widgets.adminuser",["adf.provider"]).value("adminuserServiceUrl","api/v1/admin/user").config(function(a){a.widget("adminuser",{title:"Admin User",description:"Users admin",templateUrl:"js/widgets/adminuser/adminuser.html",controller:"adminuserCtrl",resolve:{users:function(a,d){return a.get()}},edit:{templateUrl:"js/widgets/adminuser/edit.html"}})}).service("adminuserService",function(a,b,d){return{get:function(){var c=a.defer();b.get(d+"/get").success(function(a){a&&a.data?c.resolve(a.data):
c.reject()}).error(function(){c.reject()});return c.promise},save:function(c){var e=a.defer();console.log(c);b.post(d+"/new",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},update:function(c){var e=a.defer();console.log(c);b.post(d+"/edit",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},"delete":function(c){var e=a.defer();b["delete"](d+"/delete/"+c).success(function(a){a&&
a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise}}}).controller("adminuserCtrl",function(a,b,d,c,e,g,h){a.showtable=!0;a.inactiveTab=!1;a.activeTab=!0;a.editTab=!1;a.newTab=!1;a.activeMainTab=!0;a.disabled=!1;a.removeUserTab=function(b){a.activeTab=!0;a.activeMainTab=!0;a.editTab=!1;a.newTab=!1;a.activeNewTab=!1;a.tabShown=!0};a.newUser=function(){a.newuser=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=!1;a.newTab=!0;a.activeMainTab=!1;a.tabShown=!1};a.editUser=
function(){a.newuser=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=!0;a.newTab=!1;a.activeMainTab=!1;a.tabShown=!1};a.addNewUser=function(){console.log("NEW USER");a.errorNewUserShow=!1;a.removeUserTab();var b={};b.param={email:a.newuser.email,firstname:a.newuser.firstname,grp:a.newuser.grp,lastname:a.newuser.lastname,password:a.newuser.password1,username:a.newuser.username,department:a.newuser.department,active:a.newuser.active};c.save(b).then(function(b){console.log("ZZZZZZZZZZZZ");a.gridOptions.data.length=
0;e(function(){a.gridOptions.data=b})})};a.doEditUser=function(){console.log("Edit USER");a.editTab=!1;a.newTab=!1;a.activeNewTab=!1;a.activeMainTab=!0;a.activeTab=!0;a.errorEditUserShow=!1;a.tabShown=!0;var b={};b.param={email:a.user.email,firstname:a.user.firstname,gid:a.user.gid,grp:a.user.grp,lastname:a.user.lastname,password:a.user.password1,username:a.user.username,department:a.user.department,active:a.user.active,uid:a.user.uid};c.update(b).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=
b})})};a.doDeleteUser=function(){console.log("Delete USER");h.swal({title:"Are you sure?",text:"Your will not be able to recover this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(b){b&&(a.editTab=!1,a.newTab=!1,a.activeNewTab=!1,a.activeMainTab=!0,a.activeTab=!0,a.tabShown=!0,c["delete"](a.user.uid).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=b})}),a.removeAlarmTab())})};
a.gridOptions={showFooter:!1,enableSorting:!0,enableFiltering:!0,multiSelect:!1,enableRowSelection:!1,enableSelectAll:!1,enableRowHeaderSelection:!1,rowTemplate:'<div ng-click="grid.appScope.onDblClickRow(row)" ng-dblclick="grid.appScope.onDblClickRow(row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',noUnselect:!0};a.gridOptions.rowIdentity=function(a){return a.id};
a.gridOptions.onRegisterApi=function(b){a.gridApi=b};a.onDblClickRow=function(b){a.editTab=!0;a.activeTab=!1;a.newTab=!1;a.user=b.entity};a.Delete=function(b){b=a.gridOptions.data.indexOf(b.entity);a.gridOptions.data.splice(b,1)};a.gridOptions.columnDefs=[{name:"uid",enableCellEdit:!1,width:50},{name:"gid",width:50},{name:"username",displayName:"username"},{name:"firstname",displayName:"Firstname"},{name:"lastname",displayName:"Lastname"},{name:"email",displayName:"Email"},{name:"department",displayName:"Department"},
{name:"regdate",displayName:"Registered",type:"date",cellFilter:'date:"yyyy-MM-dd"'},{name:"lastvisit",displayName:"Last",type:"date",cellFilter:'date:"yyyy-MM-dd"'},{name:"active",displayName:"Active",type:"boolean",width:50}];console.log("ADM-ROW_USER");console.log(b);a.gridOptions.data=b}).controller("userSelectDialogCtrl",function(a,b,d,c){b.user=c;b.hstep=1;b.mstep=15;b.options={hstep:[1,2,3],mstep:[1,5,10,15,25,30]};b.$watch("timerange.from",function(d,c){a.info("Date Changed: "+d);b.opened=
!1});b.open=function(a,d){a.preventDefault();a.stopPropagation();b[d]=!0};b.done=function(){d.close(b.timerange)}});angular.module("homer.widgets.alarm",["adf.provider"]).value("alarmServiceUrl","api/v1/alarm/config").config(function(a){a.widget("alarm",{title:"Alarm Settings",description:"alarm settngs",templateUrl:"js/widgets/alarm/alarm.html",controller:"alarmCtrl",resolve:{alarms:function(a,d){return a.get()}},edit:{templateUrl:"js/widgets/alarm/edit.html"}})}).service("alarmService",function(a,b,d){return{get:function(){var c=a.defer();b.get(d+"/get").success(function(a){a&&a.data?c.resolve(a.data):c.reject()}).error(function(){c.reject()});
return c.promise},save:function(c){var e=a.defer();console.log(c);b.post(d+"/new",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},update:function(c){var e=a.defer();console.log(c);b.post(d+"/edit",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},"delete":function(c){var e=a.defer();b["delete"](d+"/delete/"+c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});
return e.promise}}}).controller("alarmCtrl",function(a,b,d,c,e,g,h){a.showtable=!0;a.inactiveTab=!1;a.activeTab=!0;a.editTab=!1;a.newTab=!1;a.activeMainTab=!0;a.disabled=!1;a.removeAlarmTab=function(b){a.activeTab=!0;a.activeMainTab=!0;a.editTab=!1;a.newTab=!1;a.activeNewTab=!1;a.tabShown=!0};a.newAlarm=function(){a.newalarm=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=!1;a.newTab=!0;a.activeMainTab=!1;a.tabShown=!1};a.editAlarm=function(){a.newalarm=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=
!0;a.newTab=!1;a.activeMainTab=!1;a.tabShown=!1};a.addNewAlarm=function(){console.log("NEW Alarm");a.errorNewAlarmShow=!1;a.removeAlarmTab();var b={};b.param={email:a.newalarm.email,name:a.newalarm.name,startdate:a.newalarm.startdate,stopdate:a.newalarm.stopdate,type:a.newalarm.type,value:a.newalarm.value,notify:a.newalarm.notify,active:a.newalarm.active};c.save(b).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=b})})};a.doEditAlarm=function(){console.log("Edit USER");
a.editTab=!1;a.newTab=!1;a.activeNewTab=!1;a.activeMainTab=!0;a.activeTab=!0;a.errorEditAlarmShow=!1;a.tabShown=!0;var b=a.recalarm.id;console.log(a.recalarm);console.log(a.recalarm.value);var d={};d.param={email:a.recalarm.email,name:a.recalarm.name,startdate:a.recalarm.startdate,stopdate:a.recalarm.stopdate,value:a.recalarm.value,type:a.recalarm.type,notify:a.recalarm.notify,active:a.recalarm.active,id:b};console.log(d);c.update(d).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=
b})})};a.doDeleteAlarm=function(){console.log("Delete USER");h.swal({title:"Are you sure?",text:"Your will not be able to recover this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(b){b&&(console.log("DELEEEEEEEEEEEEEEEEEE"),a.editTab=!1,a.newTab=!1,a.activeNewTab=!1,a.activeMainTab=!0,a.activeTab=!0,a.tabShown=!0,c["delete"](a.recalarm.id).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=
b})}),a.removeAlarmTab())})};a.gridOptions={showFooter:!1,enableSorting:!0,enableFiltering:!0,multiSelect:!1,enableRowSelection:!1,enableSelectAll:!1,enableRowHeaderSelection:!1,rowTemplate:'<div ng-click="grid.appScope.onDblClickRow(row)" ng-dblclick="grid.appScope.onDblClickRow(row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',noUnselect:!0};a.gridOptions.rowIdentity=
function(a){return a.id};a.gridOptions.onRegisterApi=function(b){a.gridApi=b};a.onDblClickRow=function(b){a.editTab=!0;a.activeTab=!1;a.newTab=!1;a.recalarm=b.entity};a.Delete=function(b){b=a.gridOptions.data.indexOf(b.entity);a.gridOptions.data.splice(b,1)};a.gridOptions.columnDefs=[{name:"id",enableCellEdit:!1,width:50},{name:"name",displayName:"Name"},{name:"startdate",displayName:"Start date",type:"date",cellFilter:'date:"yyyy-MM-dd"'},{name:"stopdate",displayName:"Stop date",type:"date",cellFilter:'date:"yyyy-MM-dd"'},
{name:"type",displayName:"Type"},{name:"value",displayName:"Value"},{name:"notify",displayName:"Notify"},{name:"email",displayName:"Email"},{name:"createdate",displayName:"Create date",type:"date",cellFilter:'date:"yyyy-MM-dd"'},{name:"active",displayName:"Active",type:"boolean",width:50}];console.log("ADM-ROW_USER");console.log(b);a.gridOptions.data=b}).controller("alarmSelectDialogCtrl",function(a,b,d,c){b.alarm=c;b.hstep=1;b.mstep=15;b.options={hstep:[1,2,3],mstep:[1,5,10,15,25,30]};b.$watch("timerange.from",
function(d,c){a.info("Date Changed: "+d);b.opened=!1});b.open=function(a,d){a.preventDefault();a.stopPropagation();b[d]=!0};b.done=function(){d.close(b.timerange)}});angular.module("homer.widgets.alarmlist",["adf.provider"]).value("alarmListServiceUrl","api/v1/alarm/list").config(function(a){a.widget("alarmlist",{title:"Alarm List",description:"alarm lists",templateUrl:"js/widgets/alarmlist/alarmlist.html",controller:"alarmListCtrl",reload:!0,resolve:{alarms:function(a,d){return a.get()}},edit:{templateUrl:"js/widgets/alarmlist/edit.html"}})}).service("alarmListService",function(a,b,d){return{get:function(){var c=a.defer();b.get(d+"/get").success(function(a){a&&
a.data?c.resolve(a.data):c.reject()}).error(function(){c.reject()});return c.promise},save:function(c){var e=a.defer();console.log(c);b.post(d+"/new",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},update:function(c){var e=a.defer();console.log(c);b.post(d+"/edit",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},"delete":function(c){var e=a.defer();b["delete"](d+"/delete/"+
c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise}}}).controller("alarmListCtrl",function(a,b,d,c,e,g,h){a.getBkgColorTable=function(a){var b="#EDFBFF";1==a&&(b="#FF8080");return{"background-color":b}};a.gridListOptions={showFooter:!1,enableSorting:!0,enableFiltering:!0,multiSelect:!1,enableRowSelection:!1,enableSelectAll:!1,enableRowHeaderSelection:!1,rowTemplate:'<div ng-style="row.isSelected && {} || grid.appScope.getBkgColorTable(row.entity.status)"><div ng-click="grid.appScope.onDblClickRow(row)"   ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell></div></div>',
noUnselect:!0};a.gridListOptions.rowIdentity=function(a){return a.id};a.gridListOptions.onRegisterApi=function(b){a.gridApi=b};a.onDblClickRow=function(a){console.log("Double click",a);if(1==a.entity.status){a.entity.status=0;var b={};b.param={id:a.entity.id,status:0};console.log(b);c.update(b).then(function(b){a.entity.status=0})}};a.Delete=function(b){b=a.gridListOptions.data.indexOf(b.entity);a.gridListOptions.data.splice(b,1)};a.gridListOptions.columnDefs=[{name:"id",enableCellEdit:!1,width:50},
{name:"type",displayName:"Type"},{name:"total",displayName:"Total"},{name:"source_ip",displayName:"Source IP"},{name:"description",displayName:"Description"},{name:"create_date",displayName:"Create date",type:"date",cellFilter:'date:"yyyy-MM-dd"'},{name:"status",displayName:"Status",type:"boolean",width:50}];console.log("ADM-ROW_USER");a.gridListOptions.data=b});angular.module("homer.widgets.adminalias",["adf.provider"]).value("adminaliasServiceUrl","api/v1/admin/alias").config(function(a){a.widget("adminalias",{title:"Admin Alias",description:"Alias admin",templateUrl:"js/widgets/adminalias/adminalias.html",controller:"adminaliasCtrl",resolve:{aliases:function(a,d){return a.get()}},edit:{templateUrl:"js/widgets/adminalias/edit.html"}})}).service("adminaliasService",function(a,b,d){return{get:function(){var c=a.defer();b.get(d+"/get").success(function(a){a&&
a.data?c.resolve(a.data):c.reject()}).error(function(){c.reject()});return c.promise},save:function(c){var e=a.defer();console.log(c);b.post(d+"/new",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},update:function(c){var e=a.defer();console.log(c);b.post(d+"/edit",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},"delete":function(c){var e=a.defer();b["delete"](d+"/delete/"+
c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise}}}).controller("adminaliasCtrl",function(a,b,d,c,e,g,h){a.showtable=!0;a.inactiveTab=!1;a.activeTab=!0;a.editTab=!1;a.newTab=!1;a.activeMainTab=!0;a.disabled=!1;a.removeAliasTab=function(b){a.activeTab=!0;a.activeMainTab=!0;a.editTab=!1;a.newTab=!1;a.activeNewTab=!1;a.tabShown=!0};a.newAlias=function(){a.newalias=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=!1;a.newTab=!0;a.activeMainTab=
!1;a.tabShown=!1};a.editAlias=function(){a.newalias=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=!0;a.newTab=!1;a.activeMainTab=!1;a.tabShown=!1};a.addNewAlias=function(){a.errorNewAliasShow=!1;a.removeAliasTab();var b={};b.param={gid:10,ip:a.newalias.ip,port:a.newalias.port,alias:a.newalias.alias,status:a.newalias.status};c.save(b).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=b})})};a.doEditAlias=function(){console.log("Edit ALIAS");a.editTab=!1;a.newTab=!1;a.activeNewTab=
!1;a.activeMainTab=!0;a.activeTab=!0;a.errorEditAliasShow=!1;a.tabShown=!0;var b={};b.param={gid:10,ip:a.arec.ip,port:a.arec.port,alias:a.arec.alias,status:a.arec.status,id:a.arec.id};c.update(b).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=b})})};a.doDeleteAlias=function(){console.log("Delete ALIAS");h.swal({title:"Are you sure?",text:"Your will not be able to recover this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",
closeOnConfirm:!0,closeOnCancel:!0},function(b){b&&(a.editTab=!1,a.newTab=!1,a.activeNewTab=!1,a.activeMainTab=!0,a.activeTab=!0,a.tabShown=!0,c["delete"](a.arec.id).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=b})}),a.removeAliasTab())})};a.gridOptions={showFooter:!1,enableSorting:!0,enableFiltering:!0,multiSelect:!1,enableRowSelection:!1,enableSelectAll:!1,enableRowHeaderSelection:!1,rowTemplate:'<div ng-click="grid.appScope.onDblClickRow(row)" ng-dblclick="grid.appScope.onDblClickRow(row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',
noUnselect:!0};a.gridOptions.rowIdentity=function(a){return a.id};a.gridOptions.onRegisterApi=function(b){a.gridApi=b};a.onDblClickRow=function(b){a.editTab=!0;a.activeTab=!1;a.newTab=!1;a.arec=b.entity};a.Delete=function(b){b=a.gridOptions.data.indexOf(b.entity);a.gridOptions.data.splice(b,1)};a.gridOptions.columnDefs=[{name:"id",enableCellEdit:!1,width:50},{name:"alias",displayName:"Alias"},{name:"gid",width:50},{name:"ip",displayName:"IP"},{name:"port",displayName:"Port"},{name:"status",displayName:"status"},
{name:"created",displayName:"Created",type:"date",cellFilter:'date:"yyyy-MM-dd"'}];a.gridOptions.data=b});angular.module("homer.widgets.adminnode",["adf.provider"]).value("adminnodeServiceUrl","api/v1/admin/node").config(function(a){a.widget("adminnode",{title:"Admin Node",description:"Nodes admin",templateUrl:"js/widgets/adminnode/adminnode.html",controller:"adminnodeCtrl",resolve:{nodes:function(a,d){return a.get()}},edit:{templateUrl:"js/widgets/adminnode/edit.html"}})}).service("adminnodeService",function(a,b,d){return{get:function(){var c=a.defer();b.get(d+"/get").success(function(a){a&&a.data?c.resolve(a.data):
c.reject()}).error(function(){c.reject()});return c.promise},save:function(c){var e=a.defer();console.log(c);b.post(d+"/new",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},update:function(c){var e=a.defer();console.log(c);b.post(d+"/edit",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},"delete":function(c){var e=a.defer();b["delete"](d+"/delete/"+c).success(function(a){a&&
a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise}}}).controller("adminnodeCtrl",function(a,b,d,c,e,g,h){a.showtable=!0;a.inactiveTab=!1;a.activeTab=!0;a.editTab=!1;a.newTab=!1;a.activeMainTab=!0;a.disabled=!1;a.removeNodeTab=function(b){a.activeTab=!0;a.activeMainTab=!0;a.editTab=!1;a.newTab=!1;a.activeNewTab=!1;a.tabShown=!0};a.newNode=function(){a.newnode=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=!1;a.newTab=!0;a.activeMainTab=!1;a.tabShown=!1};a.editNode=
function(){a.newnode=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=!0;a.newTab=!1;a.activeMainTab=!1;a.tabShown=!1};a.addNewNode=function(){console.log("NEW NODE");a.errorNewNodeShow=!1;a.removeNodeTab();var b={};b.param={host:a.newnode.host,dbname:a.newnode.dbname,dbport:a.newnode.dbport,dbusername:a.newnode.dbusername,dbpassword:a.newnode.dbpassword,dbtables:a.newnode.dbtables,name:a.newnode.name,status:a.newnode.status};c.save(b).then(function(b){console.log("ZZZZZZZZZZZZ");a.gridOptions.data.length=
0;e(function(){a.gridOptions.data=b})})};a.doEditNode=function(){console.log("Edit NODE");a.editTab=!1;a.newTab=!1;a.activeNewTab=!1;a.activeMainTab=!0;a.activeTab=!0;a.errorEditNodeShow=!1;a.tabShown=!0;var b={};b.param={host:a.noderec.host,dbname:a.noderec.dbname,dbport:a.noderec.dbport,dbusername:a.noderec.dbusername,dbpassword:a.noderec.dbpassword,dbtables:a.noderec.dbtables,name:a.noderec.name,status:a.noderec.status,id:a.noderec.id};c.update(b).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=
b})})};a.doDeleteNode=function(){console.log("Delete NODE");h.swal({title:"Are you sure?",text:"Your will not be able to recover this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(b){b&&(a.editTab=!1,a.newTab=!1,a.activeNewTab=!1,a.activeMainTab=!0,a.activeTab=!0,a.tabShown=!0,c["delete"](a.noderec.id).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=b})}),a.removeNodeTab())})};
a.gridOptions={showFooter:!1,enableSorting:!0,enableFiltering:!0,multiSelect:!1,enableRowSelection:!1,enableSelectAll:!1,enableRowHeaderSelection:!1,rowTemplate:'<div ng-click="grid.appScope.onDblClickRow(row)" ng-dblclick="grid.appScope.onDblClickRow(row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',noUnselect:!0};a.gridOptions.rowIdentity=function(a){return a.id};
a.gridOptions.onRegisterApi=function(b){a.gridApi=b};a.onDblClickRow=function(b){a.editTab=!0;a.activeTab=!1;a.newTab=!1;console.log(b.entity);a.noderec=b.entity};a.Delete=function(b){b=a.gridOptions.data.indexOf(b.entity);a.gridOptions.data.splice(b,1)};a.gridOptions.columnDefs=[{name:"id",enableCellEdit:!1,width:50},{name:"name",displayName:"Name"},{name:"host",displayName:"host"},{name:"dbname",displayName:"DB Name"},{name:"dbport",displayName:"DB Port"},{name:"dbusername",displayName:"DB User"},
{name:"dbpassword",displayName:"DB Password",cellTemplate:'<div  class="ui-grid-cell-contents"><span class="navText">******</span></div>'},{name:"dbtables",displayName:"DB Tables"},{name:"status",displayName:"status"}];console.log("ADM-ROW_ALIAS");console.log(b);a.gridOptions.data=b});angular.module("adf.widgets.news",["adf.provider"]).value("newsServiceUrl","https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&callback=JSON_CALLBACK&q=").config(function(a){a.widget("news",{title:"News",description:"Displays a RSS/Atom feed",templateUrl:"js/widgets/news/news.html",controller:"newsCtrl",resolve:{feed:function(a,d){if(d.url)return a.get(d.url)}},edit:{templateUrl:"js/widgets/news/edit.html"}})}).service("newsService",function(a,b,d){return{get:function(c){var e=a.defer();b.jsonp(d+
encodeURIComponent(c)).success(function(a){a&&a.responseData&&a.responseData.feed?e.resolve(a.responseData.feed):e.reject()}).error(function(){e.reject()});return e.promise}}}).controller("newsCtrl",function(a,b){a.feed=b});var timeZoneData={"Europe/London":0,"Europe/Amsterdam":1,"America/Los_Angeles":-8,"America/New_York":-5,"Europe/Moscow":3,"Asia/Novosibirsk":6};angular.module("homer.widget.clock",["adf.provider"]).config(function(a){a.widget("clock",{title:"Clock",description:"Displays date and time",templateUrl:"js/widgets/clock/view.html",controller:"clockController",controllerAs:"clock",config:{timePattern:"HH:mm:ss",datePattern:"YYYY-MM-DD",location:"Europe/Amsterdam",showseconds:!1},edit:{templateUrl:"js/widgets/clock/edit.html"}})}).controller("clockController",function(a,b,d){function c(a){return("0"+a).slice(-2)}function e(){a.clocks=[];angular.forEach(a.tz,
function(b){var d=new Date,e=b.offset,g=d.getTime()+6E4*d.getTimezoneOffset();d.dst()&&(e+=1);e=new Date(g+36E5*e);d=c(e.getDate())+"-"+c(e.getMonth()+1)+"-"+e.getFullYear();e=c(e.getHours())+":"+c(e.getMinutes())+":"+c(e.getSeconds());a.clocks.push({name:b.name,time:e,date:d})})}a.tz=[];d=d.location.split(",");angular.forEach(d,function(b){b=b.replace(/ /g,"");a.tz.push({offset:timeZoneData[b],name:b,update:a.config.showseconds?1E3:6E4,showseconds:a.config.showseconds?"german":"none"})});e();var g=
b(e,1E3);a.$on("$destroy",function(){b.cancel(g)})});angular.module("homer.widgets.randommsg",["adf.provider"]).config(function(a){a.widget("randommsg",{title:"Random Method",description:"Display a random SIP Method definition and RFC",templateUrl:"js/widgets/randommsg/randommsg.html",controller:"randommsgCtrl",reload:!0})}).service("randommsgService",function(){var a="INVITE: Indicates a client is being invited to participate in a call session.;ACK: Confirms that the client has received a final response to an INVITE request.;BYE: Terminates a call and can be sent by either the caller or the callee.;CANCEL: Cancels any pending request.;OPTIONS: Queries the capabilities of servers.;REGISTER: Registers the address listed in the To header field with a SIP server.;PRACK: Provisional acknowledgement.;SUBSCRIBE: Subscribes for an Event of Notification from the Notifier.;NOTIFY: Notify the subscriber of a new Event.;PUBLISH: Publishes an event to the Server.;INFO: Sends mid-session information that does not modify the session state.;REFER: Asks recipient to issue SIP request (call transfer.);MESSAGE: Transports instant messages using SIP.;UPDATE: Modifies the state of a session without changing the state of the dialog.".split(";"),
b="RFC3261 RFC3261 RFC3261 RFC3261 RFC3261 RFC3261 RFC3262 RFC6665 RFC6665 RFC3903 RFC6086 RFC3515 RFC3428 RFC3311".split(" ");return{get:function(){var d=Math.floor(Math.random()*a.length);return{text2:a[Math.floor(Math.random()*a.length)],text:a[d],author:b[d]}}}}).controller("randommsgCtrl",function(a,b){a.msg=b.get()});angular.module("sample.widgets.markdown",["adf.provider","btford.markdown"]).config(function(a){a.widget("markdown",{title:"Markdown",description:"Markdown widget",controller:"markdownCtrl",templateUrl:"js/widgets/markdown/markdown.html",edit:{templateUrl:"js/widgets/markdown/edit.html",reload:!1}})}).controller("markdownCtrl",function(a,b){b.content||(b.content="");a.config=b});angular.module("homer.widgets.quicksearch",["adf.provider"]).config(function(a){a.widget("quicksearch",{title:"Quick Search",description:"Quick Search Widget",templateUrl:"js/widgets/quicksearch/quicksearch.html",controller:"quicksearchCtrl",controllerAs:"qsearch",edit:{templateUrl:"js/widgets/quicksearch/edit.html",controller:"quicksearchEditCtrl"}})}).controller("quicksearchCtrl",["$scope","config","$location",homer.modules.core.services.profile,"$log",homer.modules.core.services.search,function(a,
b,d,c,e,g){c.profileScope.search&&c.profileScope.search instanceof Array&&(c.profileScope.search={});a.newObject=c.profileScope.search;a.newTransaction=c.profileScope.transaction;a.newResult=c.profileScope.result;a.newNode=c.profileScope.node;b.fields||(b.fields=[{name:"from_user",selection:"From"},{name:"to_user",selection:"To"},{name:"callid",selection:"Call-ID"}],b.searchbutton=!0);this.fields=b.fields;a.toggleSearchButton=function(){a.showSearchButton=!a.showSearchButton;b.searchbutton=!b.searchbutton};
a.timerange=c.profileScope.timerange;(function(){a.$watch(function(){return c.profileScope.search},function(b,d){b!==d&&(a.newObject=b)})})();a.nullSafe=function(b){a.newObject[b]||(a.newObject[b]="")};a.processSearchForm=function(b){a.newObject instanceof Array&&(a.newObject={});c.setProfile("search",a.newObject);c.setProfile("transaction",a.newTransaction);c.setProfile("result",a.newResult);c.setProfile("node",a.newNode);b=a.newResult.restype.name;"pcap"==b?a.processSearchResult(!1):"text"==b?a.processSearchResult(!0):
d.path("/result")};a.clearSearchForm=function(b){c.profileScope.search={};c.setProfile("search",a.newObject)};a.processSearchResult=function(a){var b={param:{},timestamp:{}},d=c.getProfile("transaction"),e=c.getProfile("limit"),n=c.getProfile("timerange"),m=c.getProfile("search"),q=c.getProfile("node").dbnode;b.param.transaction={};b.param.limit=e;b.param.search=m;b.param.node=q;b.timestamp.from=n.from.getTime();b.timestamp.to=n.to.getTime();angular.forEach(d.transaction,function(a,d){b.param.transaction[a.name]=
!0});var r=(new Date).getTime();g.makePcapTextData(b,a).then(function(b){var d="HOMER5_"+r+".pcap",c="application/pcap";a&&(d="HOMER5_"+r+".txt",c="attacment/text;charset=utf-8");b=new Blob([b],{type:c});saveAs(b,d)})};a.type_transaction=[{name:"call",value:"CALLS"},{name:"registration",value:"REGISTRATIONS"},{name:"rest",value:"OTHER"}];a.type_result=[{name:"table",value:"TABLE"},{name:"pcap",value:"PCAP"},{name:"text",value:"TEXT"}];a.db_node_selected=[];a.db_node=[{name:"localhost",id:"localhost"}];
g.loadNode().then(function(b){a.db_node=b});a.newResult.restype=a.type_result[0];a.newNode.node=a.db_node[0];a.type_method_selected=[];a.type_method=[{id:1,value:"INVITE",checked:!1},{id:2,value:"REGISTER",checked:!1},{id:3,value:"BYE",checked:!1},{id:4,value:"CANCEL",checked:!1},{id:5,value:"OPTIONS",checked:!1},{id:6,value:"ACK",checked:!1},{id:7,value:"PRACK",checked:!1},{id:8,value:"SUBSCRIBE",checked:!1},{id:9,value:"NOTIFY",checked:!1},{id:10,value:"PUBLISH",checked:!1},{id:11,value:"INFO",
checked:!1},{id:12,value:"REFER",checked:!1},{id:13,value:"MESSAGE",checked:!1},{id:14,value:"UPDATE",checked:!1},{id:15,value:"1xx",checked:!1},{id:16,value:"2xx",checked:!1},{id:17,value:"3xx",checked:!1},{id:18,value:"4xx",checked:!1},{id:19,value:"5xx",checked:!1},{id:20,value:"6xx",checked:!1},{id:21,value:"",checked:!1}]}]).controller("quicksearchEditCtrl",function(a){function b(){a.config.fields||(a.config.fields=[]);return a.config.fields}a.addField=function(){b().push({name:"default0"})};
a.removeField=function(a){b().splice(a,1)};a.headers=[{name:"from_user",selection:"From"},{name:"to_user",selection:"To"},{name:"ruri_user",selection:"RURI"},{name:"callid",selection:"Call-ID"},{name:"callid_aleg",selection:"B2B CID"},{name:"contact_user",selection:"Contact User"},{name:"pid_user",selection:"PID User"},{name:"auth_user",selection:"Auth User"},{name:"user_agent",selection:"User-Agent"},{name:"method",selection:"Method"},{name:"cseq",selection:"CSeq"},{name:"reason",selection:"Reason"},
{name:"msg",selection:"Message"},{name:"diversion",selection:"Diversion"},{name:"via_1",selection:"VIA"},{name:"source_ip",selection:"Source IP"},{name:"destination_ip",selection:"Dest. IP"},{name:"source_port",selection:"Source Port"},{name:"destination_port",selection:"Dest. Port"},{name:"node",selection:"Node"},{name:"uniq",selection:"Unique"},{name:"orand",selection:"Logic OR"},{name:"proto",selection:"Protocol"},{name:"family",selection:"Family"},{name:"limit",selection:"Limit Query"},{name:"transaction",
selection:"Transaction"},{name:"dbnode",selection:"DB Node"},{name:"b2b",selection:"B2B ext"},{name:"restype",selection:"Result Type"}]}).directive("ngEnter",function(){return function(a,b,d){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(d.ngEnter)}),b.preventDefault())})}}).directive("fieldDisplay",function(a){return{scope:{fieldDisplay:"=",fieldName:"=",fieldHeaders:"="},templateUrl:"js/widgets/quicksearch/template.html",link:function(a,d,c,e){a.selectedItem={name:a.fieldName,
selection:a.fieldDisplay};a.$watch("selectedItem",function(d){a.fieldDisplay=d.selection;a.fieldName=d.name},!0)}}});angular.module("homer.widgets.ripesearch",["adf.provider"]).value("RIPEServiceUrl","https://stat.ripe.net/data/visibility/data.json?resource=").config(function(a){a.widget("ripesearch",{title:"RIPE DB Search",description:"Display RIPE Visibility for a given IP/AS",templateUrl:"js/widgets/ripesearch/ripesearch.html",controller:"ripeCtrl",reload:!0,resolve:{data:function(a,d){d.rscount||(d.rscount=4);if(d.location)return a.get(d.location,d.rscount)}},edit:{templateUrl:"js/widgets/ripesearch/edit.html"}})}).service("weatcherService",
function(a,b,d){return{get:function(c,e){var g=a.defer();b.get(d+c).success(function(a){a&&"ok"===a.status?g.resolve(a):g.reject()}).error(function(){g.reject()});return g.promise}}}).controller("ripeCtrl",function(a,b,d){a.data=b;a.data.config=d});angular.module("homer.widgets.ripewhois",["adf.provider"]).value("WhoisServiceUrl","//stat.ripe.net/data/whois/data.json?resource=").config(function(a){a.widget("ripewhois",{title:"RIPE Whois Search",description:"Display RIPE WHOIS Data for a given IP/AS",templateUrl:"js/widgets/ripewhois/ripewhois.html",controller:"ripewhoCtrl",reload:!0,resolve:{data:function(a,d){if(d.location)return a.get(d.location)}},edit:{templateUrl:"js/widgets/ripewhois/edit.html"}})}).service("whoisService",function(a,b,
d){return{get:function(c){var e=a.defer();b.get(d+c).success(function(a){a&&"ok"===a.status?e.resolve(a):e.reject()}).error(function(){e.reject()});return e.promise}}}).controller("ripewhoCtrl",function(a,b,d){a.data=b});angular.module("homer.widgets.elasticaggs",["adf.provider","highcharts-ng","base64"]).value("localApiUrl","api/v1/").value("elasticaggsApiUrl","http://127.0.0.1:8086").config(function(a){a.widget("elasticaggsChart",angular.extend({title:"Elastic Aggs",description:"Display Elasticsearch Aggs",controller:"elasticaggsCtrl"},{templateUrl:"js/widgets/elasticaggs/elasticaggs.html",reload:!0,resolve:{sipdata:function(a,d,c){if(c.path&&c.query)return d.get(c,c.path,c.query);c.query=JSON.stringify({size:0,
aggregations:{data:{$querytype:{field:"$query",size:0}}}},null,2)}},edit:{templateUrl:"js/widgets/elasticaggs/edit.html",controller:"elasticaggsEditController"},refresh:!0}))}).service("elasticaggsService",function(a,b,d,c,e){return{get:function(d,h,f){var k=a.defer(),l=c.getProfile("timerange");f=f.replace(/"\$fromts"/g,l.from.getTime());f=f.replace(/"\$tots"/g,l.to.getTime());f="undefined"!==typeof d.query_string&&-1<d.query_string.indexOf('"')?f.replace(/"\$query"/g,d.query_string):f.replace(/"\$query"/g,
'"'+d.query_string+'"');d.chart.query_type&&(f=f.replace(/"\$querytype"/g,'"'+d.chart.query_type+'"'));d.db.user&&-1===h.indexOf("@")&&(console.log("ES: Custom HTTP authentication"),b.defaults.headers.common.Authorization="Basic "+e.encode(d.db.password?d.db.user+":"+d.db.password:d.db.user+":"));console.log("ES-URL:",h);f=JSON.parse(f);console.log("ES-QUERY",f);b.post(h,f).success(function(a){d.debugresp=JSON.stringify(a);console.log("ES-DATA:",a.aggregations);"value_count"===d.chart.query_type?
console.log("ES: AGGS COUNT"):"terms"===d.chart.query_type?console.log("ES: AGGS TERMS"):"sum"===d.chart.query_type?console.log("ES: AGGS SUM"):"sum"===d.chart.query_type?console.log("ES: AGGS SUM"):"avg"===d.chart.query_type?console.log("ES: AGGS SUM"):console.log("REJECT: unsupported type?");k.resolve(a.aggregations.data.buckets)}).error(function(){console.log("ES ERROR");k.reject()});return k.promise}}}).controller("elasticaggsCtrl",function(a,b,d,c){function e(d){var c={},e=b.panel.fieldname.split(";"),
k=b.panel.fieldvalue.split(";");angular.forEach(d,function(a){var d=a[b.panel.timefield],g=[];angular.forEach(e,function(a){g.push(a)});var l=g.join("|"),p=0;angular.forEach(k,function(e){b.panel.fieldsum?(c.hasOwnProperty(l)||(c[l]=[]),p=a[e],c[l][1]=p):(c.hasOwnProperty(l)||(c[l]=[]),p=a[e],c[l].push([d,p]))})});var l=[];"pie"==b.chart.type.value?(l.push({type:b.chart.type.value,name:a.$parent.model.title,data:[]}),angular.forEach(c,function(a,b){var d=0;angular.forEach(a,function(a){d+=a[1]});
l[0].data.push([b,d])})):angular.forEach(c,function(a,d){a.sort(function(a,b){return a[0]-b[0]});l.push({name:d,type:b.chart.type.value,data:a})});console.log("ES-SERIES-DATA:",l);return l}console.log(b);b.panel&&(b.panel.fieldname.split(";"),b.panel.fieldvalue.split(";"),a.reloadIt=function(){a.$parent.changeReloading(!0);c.get(b,b.path,b.query).then(function(b){b=e(b);var d=a.chartObj;if("undefined"!==typeof d.series){for(var c=b.length,k=0,l=d.series.length;k<l;k++)k<c?d.series[k].update(b[k],
!0):d.series[k]&&d.series[k].remove(!1);for(k;k<c;k++)d.addSeries(b[k],!0);a.$parent.changeReloading(!1)}},function(a){})},d&&(d=e(d),"pie"==b.chart.type.value?(a.chartConfig={chart:{type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.$parent.model.title,style:{display:"none"}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:0,dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},showInLegend:!1}},
series:d},b.chart.ccc&&(d=[],d=b.chart.ccc.split(","),a.chartConfig.hasOwnProperty("colors")||(a.chartConfig.colors=[]),a.chartConfig.colors=d,console.log("CCOLOR-PIE:",a.chartConfig)),b.chart.ddd&&(a.chartConfig.chart.options3d={enabled:!0,alpha:45,beta:0},a.chartConfig.plotOptions.pie.depth=35),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&(a.chartConfig.size.width=b.chart.size.width),0<parseInt(b.chart.size.height)&&(a.chartConfig.size.height=
b.chart.size.height)),b.chart.legend&&b.chart.legend.enabled&&1==b.chart.legend.enabled&&(a.chartConfig.plotOptions.pie.showInLegend=b.chart.legend.enabled,a.chartConfig.plotOptions.pie.dataLabels.enabled=!1)):(a.chartConfig={chart:{type:b.chart.type.value},title:{text:a.$parent.model.title,style:{display:"none"}},xAxis:{type:"datetime"},yAxis:{title:{text:null},min:0},plotOptions:{column:{}},legend:{enabled:!1,borderWidth:0},series:d},"terms"===b.chart.query_type&&(console.log("ES-TERMS!"),a.chartConfig.xAxis.type=
void 0,a.chartConfig.xAxis.categories=[],angular.forEach(d,function(b){angular.forEach(b.data,function(b){a.chartConfig.xAxis.categories.push([b[0]])})}),"undefined"!==typeof a.chartConfig.series[0]&&(a.chartConfig.series[0].colorByPoint=!0)),b.chart.ccc&&(d=[],d=b.chart.ccc.split(","),a.chartConfig.hasOwnProperty("colors")||(a.chartConfig.colors=[]),a.chartConfig.colors=d),b.chart.sss&&(d=b.chart.type.value,a.chartConfig.plotOptions[d]={},a.chartConfig.plotOptions[d].stacking=b.chart.ppp?"percent":
"normal"),b.chart.ddd&&(a.chartConfig.chart.options3d={enabled:!0,alpha:15,beta:10,depth:50,viewDistance:30},a.chartConfig.plotOptions.column.depth=25,a.chartConfig.chart.margin=60),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&(a.chartConfig.size.width=b.chart.size.width),0<parseInt(b.chart.size.height)&&(a.chartConfig.size.height=b.chart.size.height)),b.chart.legend&&(b.chart.legend.align&&(a.chartConfig.legend.align=b.chart.legend.align),
b.chart.legend.enabled&&(a.chartConfig.legend.enabled=b.chart.legend.enabled),b.chart.legend.layout&&(a.chartConfig.legend.layout=b.chart.legend.layout)),b.chart.yaxis&&b.chart.yaxis.title&&0<b.chart.yaxis.title.length&&(a.chartConfig.yAxis.title.text=b.chart.yaxis.title))))}).controller("elasticaggsEditController",function(a,b,d,c){a.charts=[{id:1,label:"Spline",value:"spline"},{id:2,label:"Line",value:"line"},{id:3,label:"Area spline",value:"areaspline"},{id:4,label:"Bar",value:"bar"},{id:5,label:"Scatter",
value:"scatter"},{id:6,label:"Pie",value:"pie"},{id:7,label:"Column",value:"column"}];a.query_type=[{name:"Metric",value:"value_count"},{name:"Terms",value:"terms"},{name:"Stats",value:"stats"},{name:"Stats",value:"stats"},{name:"Max",value:"max"},{name:"Min",value:"min"},{name:"Avg",value:"avg"}];a.query_res=[{name:"1 Minute",value:"1m"},{name:"5 Minutes",value:"5m"},{name:"15 Minutes",value:"15m"},{name:"30 Minutes",value:"30m"},{name:"60 Minutes",value:"1h"}];a.legend_align=[{name:"center",value:"center"},
{name:"right",value:"right"},{name:"left",value:"left"}];a.legend_layout=[{name:"horizontal",value:"horizontal"},{name:"vertical",value:"vertical"}];a.updateDebugUrl=function(){if(a.config&&a.config.query&&a.config.path&&a.config.db)try{JSON.parse(a.config.query);var b=c.getProfile("timerange"),d=a.config.query,d=d.replace(/"\$fromts"/g,b.from.getTime()),d=d.replace(/"\$tots"/g,b.to.getTime()),d="undefined"!==typeof a.config_query&&-1<a.config.query_string.indexOf('"')?d.replace(/"\$query"/g,a.config.query_string):
d.replace(/"\$query"/g,'"'+a.config.query_string+'"');a.query_type&&(d=d.replace(/"\$querytype"/g,'"'+a.config.chart.query_type+'"'));var h=a.config.path,b="";a.config.db.user&&(b="-U "+a.config.db.user);a.config.db.password&&(b+=":"+a.config.db.password);a.debug="curl -v -X GET "+b+" '"+h+"' -d '"+d+"\n";a.parsingStatus="ok";a.parsingColorClass="green"}catch(f){a.parsingStatus="Bad parsing: ["+f.message+"]",a.parsingColorClass="red"}};a.updateDebugUrl()});(function(a,b){defineHomerAngularModule(b.modules.app.name,["adf","ui.router","ui.bootstrap","ui.grid","ui.grid.resizeColumns","ui.grid.autoResize","ui.grid.pagination","ui.grid.selection","oitozero.ngSweetAlert","ngAnimate","ngCookies","ngSanitize","dialogs.main","angularFileUpload","homer.modal","homer.cflow",b.modules.core.name,b.modules.structures.name,b.modules.auth.name,b.modules.admin.name,b.modules.pages.name,"homer.widget.clock","homer.widgets.sipcapture","homer.widgets.quicksearch","homer.widgets.ripesearch",
"homer.widgets.ripewhois","homer.widgets.querycap","homer.widgets.elasticap","homer.widgets.elasticaggs","homer.widgets.adminuser","homer.widgets.adminalias","homer.widgets.adminnode","homer.widgets.alarm","homer.widgets.alarmlist","adf.widgets.news","adf.widgets.linklist","homer.widgets.randommsg"])})(angular,homer);String.prototype.hashCode=function(){var a=0,b,d,c;if(0==this.length)return a;b=0;for(c=this.length;b<c;b++)d=this.charCodeAt(b),a=(a<<5)-a+d,a|=0;return a};var DEBUG=!0;
if(!DEBUG){window.console||(window.console={});for(var methods=["log","debug","warn","info"],i=0;i<methods.length;i++)console[methods[i]]=function(){}};(function(a,b){defineHomerAngularModule(b.modules.app.name).controller("homerAppController",["$scope","$rootScope","eventbus","$state",b.modules.auth.services.authentication,"$location","dialogs",b.modules.core.services.profile,function(a,c,e,g,h,f,k,l){c.homerApp="HOMER";c.homerVersion="5.0.0beta1";console.log("HOMER INIT:",c.homerVersion);a.header="templates/empty.html";a.menu="templates/empty.html";a.ribbon="templates/empty.html";a.footer="templates/empty.html";a.shortcut="templates/empty.html";
a.templateSet=!1;c.currentUser={};a.addDashBoard=function(){k.create("templates/dialogs/newdialog.html","newDashboardCtrl",{},{key:!1,back:"static"}).result.then(function(c){"upload"!=c?(a.dashboardname=c,e.broadcast(b.modules.pages.events.newDashboardItem,c)):e.broadcast(b.modules.pages.events.dashBoardChanged,c)},function(){a.name="No name, defaulting to New"})};a.showLeftMenu=!1;a.boolLeftMenu=!1;a.boolDropDownAlert=!1;a.boolDropDownUserMenu=!1;a.boolDropDownSearch=!1;a.changeClass=function(){a.boolLeftMenu=
!a.boolLeftMenu;e.broadcast("globalWidgetRecreate",1)};a.triggerDoSearch=function(){a.boolLeftMenu=!1};a.expandLeftMenu=function(){a.boolLeftMenu=!1};a.showAlertBox=function(){a.boolDropDownAlert=!a.boolDropDownAlert};a.showSearchBox=function(){a.boolDropDownSearch=!a.boolDropDownSearch};a.showUserMenuBox=function(){a.boolDropDownUserMenu=!a.boolDropDownUserMenu};a.showLastMenuBox=function(){a.boolDropDownLastMenu=!a.boolDropDownLastMenu};a.showRefreshMenuBox=function(){a.boolDropDownRefreshMenu=
!a.boolDropDownRefreshMenu};a.searchClass="btn btn-primary";a.showMenu=function(){a.showLeftMenu=!a.showLeftMenu};a.doLogout=function(){a.showLeftMenu=!1;a.dropDownUserMenuClass="";f.path(b.modules.auth.routes.logout)};a.doResetProfile=function(){a.showLeftMenu=!1;a.dropDownUserMenuClass="";l.deleteAllProfile();console.log(l);f.path(b.modules.auth.routes.logout)};e.subscribe(b.modules.auth.events.userLoggedIn,function(b,c){a.templateSet||(a.showLeftMenu=!0,a.header="templates/header.html",a.menu=
"templates/left-panel.html",a.ribbon="templates/ribbon.html",a.footer="templates/footer.html",a.shortcut="templates/shortcut.html",a.templateSet=!0,""!=g.current.name&&"login"!=g.current.name&&g.go(g.current,{},{reload:!0}))});e.subscribe(b.modules.auth.events.userLoggedOut,function(b,c){a.showLeftMenu=!1;a.templateSet&&(a.header=null,a.menu=null,a.ribbon=null,a.footer=null,a.shortcut=null,a.templateSet=!1)});e.subscribe(b.modules.pages.events.hideLeftMenu,function(b,c){a.boolLeftMenu=!0})}]).controller("HomerDatepickerCtrlTest",
["$scope","$rootScope",function(b,c){b.today=function(){b.dt=new Date};b.today();b.clear=function(){b.dt=null};b.toggleMin=function(){b.minDate=b.minDate?null:(new Date).setFullYear(2013,0,1);b.maxDate=b.maxDate?null:(new Date).setFullYear(2032,0,1)};b.toggleMin();b.open=function(a,c){a.preventDefault();a.stopPropagation();b[c]=!0};b.dateOptions={formatYear:"yy",startingDay:1};b.formats=["yyyy/MM/dd","yyyy-MM-dd","dd.MM.yyyy","shortDate"];b.format=b.formats[1];b.deleteDashboard=function(){a.element("#deleteThisDash").click()}}]).controller("HomerDatepickerCtrl",
function(d,c,e,g,h,f){(new Date).setHours((new Date).getHours()-2);d.timerange=e.profileScope.timerange;var k;(function(){d.$watch(function(){return e.profileScope.timerange},function(a,b){a!==b&&(d.timerange=a)})})();d.toggleMin=function(){d.minDate=d.minDate?null:(new Date).setFullYear(2013,0,1);d.maxDate=d.maxDate?null:(new Date).setFullYear(2032,0,1)};d.toggleMin();d.dateOptions={formatYear:"yy",startingDay:1};d.formats=["yyyy/MM/dd","yyyy-MM-dd","dd.MM.yyyy","shortDate"];d.format=d.formats[1];
d.setFromNow=function(){var a=new Date((new Date).setMinutes((new Date).getMinutes()+5));d.timerange={from:new Date,to:a};e.setProfile("timerange",d.timerange);g.broadcast("globalWidgetReload",1)};d.launch=function(){c.create("templates/dialogs/timerange.html","timerangeDialogCtrl",d.timerange).result.then(function(a){d.timerange=a;e.setProfile("timerange",d.timerange)})};d.last=function(a){a=new Date((new Date).setMinutes((new Date).getMinutes()-a));d.timerange={from:a,to:new Date};e.setProfile("timerange",
d.timerange);g.broadcast("globalWidgetReload",1)};d.refresh=function(c){console.log("REFRESH:"+c);c=parseInt(c);1>c?g.broadcast("globalWidgetReload",1):a.isDefined(k)?d.cancelRefresh():(d.activeInterval=!0,k="result"==f.current.name?h(function(){d.timerange.to.setSeconds(d.timerange.to.getSeconds()+c);e.setProfile("timerange",d.timerange);g.broadcast(b.modules.pages.events.resultSearchSubmit,"fullsearch")},1E3*c):h(function(){d.timerange.from.setSeconds(d.timerange.from.getSeconds()+c);d.timerange.to.setSeconds(d.timerange.to.getSeconds()+
c);e.setProfile("timerange",d.timerange);g.broadcast("globalWidgetReload",1)},1E3*c))};d.cancelRefresh=function(){a.isDefined(k)&&(h.cancel(k),k=void 0,d.activeInterval=!1)};g.subscribe(b.modules.pages.events.destroyRefresh,function(a,b,c){d.cancelRefresh()})}).controller("timerangeDialogCtrl",function(b,c,e,g){c.timerange=g;c.hstep=1;c.mstep=15;c.options={hstep:[1,2,3],mstep:[1,5,10,15,25,30]};c.$watch("timerange.from",function(a,e){b.info("Date Changed: "+a);c.opened=!1});c.setDate=function(){a.isDefined(c.timerange.from)||
(c.timerange.from=new Date);a.isDefined(c.timerange.to)||(c.timerange.to=new Date)};c.setDate();c.open=function(a,b){a.preventDefault();a.stopPropagation();c[b]=!0};c.setToNow=function(a){1==a?c.timerange.from=new Date:c.timerange.to=new Date};c.done=function(){e.close(c.timerange)}}).config(function(a){a.useBackdrop(!0);a.useEscClose(!0);a.useCopy(!1);a.setSize("sm")}).controller("newDashboardCtrl",function(b,c,e,g){b.dashboard={name:""};b.cancel=function(){c.dismiss("canceled")};b.hitEnter=function(c){!a.equals(c.keyCode,
13)||a.equals(b.dashboard,null)||a.equals(b.dashboard,"")||b.save()};var h=b.uploader=new g({url:"api/v1/dashboard/upload"});b.save=function(){0<b.uploader.queue.length?h.uploadAll():b.nameDialog.$valid&&c.close(b.dashboard.name)};h.filters.push({name:"customFilter",fn:function(a,b){return 1>this.queue.length}});h.onCompleteAll=function(){console.info("onCompleteAll");c.close("upload")}})})(angular,homer);(function(a,b){a.module(b.modules.auth.name).run(["$rootScope","$location","$state","$stateParams",b.modules.auth.services.authorization,b.modules.auth.services.authentication,b.modules.core.services.profile,function(a,c,e,g,h,f,k,l){var n=!1,m;a.loggedIn=!1;f.session().then(function(e){e.isAuthenticated&&(0==e.isAuthenticated?c.path(b.modules.auth.routes.login):(a.loggedIn=!0,a.currentUser.name=e.name,k.getAll(),e=c.path(),"/login"!=e&&"/logout"!=e||c.path(b.modules.pages.routes.home)));a.loggedIn=
!0},function(a){console.log(a);console.log("bad result");c.path(b.modules.auth.routes.login)});a.$on("$routeChangeStart",function(a,d){var e;n&&d.originalPath!==b.modules.auth.routes.login?(n=!1,c.path(m).replace()):void 0!==d.access&&(e=h.authorize(d.access.loginRequired,d.access.permissions,d.access.permissionCheckType),e===b.modules.auth.enums.authorised.loginRequired?(n=!0,m=d.originalPath,c.path(b.modules.auth.routes.login)):e===b.modules.auth.enums.authorised.notAuthorised&&c.path(b.modules.auth.routes.notAuthorised).replace())})}])})(angular,
homer);String.prototype.hashCode=function(){var a=0,b,d,c;if(0==this.length)return a;b=0;for(c=this.length;b<c;b++)d=this.charCodeAt(b),a=(a<<5)-a+d,a|=0;return a};Date.prototype.stdTimezoneOffset=function(){var a=new Date(this.getFullYear(),0,1),b=new Date(this.getFullYear(),6,1);return Math.max(a.getTimezoneOffset(),b.getTimezoneOffset())};Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};
